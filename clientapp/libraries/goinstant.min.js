!function(){var requirejs,require,define;if(function(t){function e(t,e){return y.call(t,e)}function n(t,e){var n,r,o,i,s,a,u,c,l,f,p=e&&e.split("/"),h=m.map,d=h&&h["*"]||{};if(t&&"."===t.charAt(0))if(e){for(p=p.slice(0,p.length-1),t=p.concat(t.split("/")),c=0;c<t.length;c+=1)if(f=t[c],"."===f)t.splice(c,1),c-=1;else if(".."===f){if(1===c&&(".."===t[2]||".."===t[0]))break;c>0&&(t.splice(c-1,2),c-=2)}t=t.join("/")}else 0===t.indexOf("./")&&(t=t.substring(2));if((p||d)&&h){for(n=t.split("/"),c=n.length;c>0;c-=1){if(r=n.slice(0,c).join("/"),p)for(l=p.length;l>0;l-=1)if(o=h[p.slice(0,l).join("/")],o&&(o=o[r])){i=o,s=c;break}if(i)break;!a&&d&&d[r]&&(a=d[r],u=c)}!i&&a&&(i=a,s=u),i&&(n.splice(0,s,i),t=n.join("/"))}return t}function r(e,n){return function(){return l.apply(t,g.call(arguments,0).concat([e,n]))}}function o(t){return function(e){return n(e,t)}}function i(t){return function(e){h[t]=e}}function s(n){if(e(d,n)){var r=d[n];delete d[n],v[n]=!0,c.apply(t,r)}if(!e(h,n)&&!e(v,n))throw new Error("No "+n);return h[n]}function a(t){var e,n=t?t.indexOf("!"):-1;return n>-1&&(e=t.substring(0,n),t=t.substring(n+1,t.length)),[e,t]}function u(t){return function(){return m&&m.config&&m.config[t]||{}}}var c,l,f,p,h={},d={},m={},v={},y=Object.prototype.hasOwnProperty,g=[].slice;f=function(t,e){var r,i=a(t),u=i[0];return t=i[1],u&&(u=n(u,e),r=s(u)),u?t=r&&r.normalize?r.normalize(t,o(e)):n(t,e):(t=n(t,e),i=a(t),u=i[0],t=i[1],u&&(r=s(u))),{f:u?u+"!"+t:t,n:t,pr:u,p:r}},p={require:function(t){return r(t)},exports:function(t){var e=h[t];return"undefined"!=typeof e?e:h[t]={}},module:function(t){return{id:t,uri:"",exports:h[t],config:u(t)}}},c=function(n,o,a,u){var c,l,m,y,g,_,b=[];if(u=u||n,"function"==typeof a){for(o=!o.length&&a.length?["require","exports","module"]:o,g=0;g<o.length;g+=1)if(y=f(o[g],u),l=y.f,"require"===l)b[g]=p.require(n);else if("exports"===l)b[g]=p.exports(n),_=!0;else if("module"===l)c=b[g]=p.module(n);else if(e(h,l)||e(d,l)||e(v,l))b[g]=s(l);else{if(!y.p)throw new Error(n+" missing "+l);y.p.load(y.n,r(u,!0),i(l),{}),b[g]=h[l]}m=a.apply(h[n],b),n&&(c&&c.exports!==t&&c.exports!==h[n]?h[n]=c.exports:m===t&&_||(h[n]=m))}else n&&(h[n]=a)},requirejs=require=l=function(e,n,r,o,i){return"string"==typeof e?p[e]?p[e](n):s(f(e,n).f):(e.splice||(m=e,n.splice?(e=n,n=r,r=null):e=t),n=n||function(){},"function"==typeof r&&(r=o,o=i),o?c(t,e,n,r):setTimeout(function(){c(t,e,n,r)},4),l)},l.config=function(t){return m=t,m.deps&&l(m.deps,m.callback),l},define=function(t,n,r){n.splice||(r=n,n=[]),e(h,t)||e(d,t)||(d[t]=[t,n,r])},define.amd={jQuery:!0}}(),define("../node_modules/almond/almond",function(){}),function(t){function e(t,e,n){for(var r=(n||0)-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1}function n(t,n){var r=typeof n;if(t=t.cache,"boolean"==r||null==n)return t[n];"number"!=r&&"string"!=r&&(r="object");var o="number"==r?n:w+n;return t=t[r]||(t[r]={}),"object"==r?t[o]&&e(t[o],n)>-1?0:-1:t[o]?0:-1}function r(t){var e=this.cache,n=typeof t;if("boolean"==n||null==t)e[t]=!0;else{"number"!=n&&"string"!=n&&(n="object");var r="number"==n?t:w+t,o=e[n]||(e[n]={});"object"==n?(o[r]||(o[r]=[])).push(t)==this.array.length&&(e[n]=!1):o[r]=!0}}function o(t){return t.charCodeAt(0)}function i(t,e){var n=t.index,r=e.index;if(t=t.criteria,e=e.criteria,t!==e){if(t>e||"undefined"==typeof t)return 1;if(e>t||"undefined"==typeof e)return-1}return r>n?-1:1}function s(t){var e=-1,n=t.length,o=c();o["false"]=o["null"]=o["true"]=o.undefined=!1;var i=c();for(i.array=t,i.cache=o,i.push=r;++e<n;)i.push(t[e]);return o.object===!1?(h(i),null):i}function a(t){return"\\"+Z[t]}function u(){return y.pop()||[]}function c(){return g.pop()||{args:"",array:null,bottom:"",cache:null,criteria:null,"false":!1,firstArg:"",index:0,init:"",leading:!1,loop:"",maxWait:0,"null":!1,number:null,object:null,push:null,shadowedProps:null,string:null,top:"",trailing:!1,"true":!1,undefined:!1,useHas:!1,useKeys:!1,value:null}}function l(t){return"function"!=typeof t.toString&&"string"==typeof(t+"")}function f(){}function p(t){t.length=0,y.length<S&&y.push(t)}function h(t){var e=t.cache;e&&h(e),t.array=t.cache=t.criteria=t.object=t.number=t.string=t.value=null,g.length<S&&g.push(t)}function d(t,e,n){e||(e=0),"undefined"==typeof n&&(n=t?t.length:0);for(var r=-1,o=n-e||0,i=Array(0>o?0:o);++r<o;)i[r]=t[e+r];return i}function m(r){function y(t){return t&&"object"==typeof t&&!$r(t)&&vr.call(t,"__wrapped__")?t:new g(t)}function g(t){this.__wrapped__=t}function S(t,e,n,r){function o(){var r=arguments,c=s?this:e;if(i||(t=e[a]),n.length&&(r=r.length?(r=Rr.call(r),u?r.concat(n):n.concat(r)):n),this instanceof o){c=te(t.prototype);var l=t.apply(c,r);return ke(l)?l:c}return t.apply(c,r)}var i=we(t),s=!n,a=e;if(s){var u=r;n=e}else if(!i){if(!r)throw new rr;e=t}return o}function Z(){var t=c();t.shadowedProps=U,t.array=t.bottom=t.loop=t.top="",t.init="iterable",t.useHas=!0,t.useKeys=!!zr;for(var e,n=0;e=arguments[n];n++)for(var r in e)t[r]=e[r];var o=t.args;t.firstArg=/^[^,]+/.exec(o)[0];var i=Jn("errorClass, errorProto, hasOwnProperty, isArguments, isArray, isString, keys, lodash, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+o+") {\n"+qr(t)+"\n}");return h(t),i(V,ir,vr,ue,$r,je,zr,y,sr,Q,Dr,Y,ar,wr)}function te(t){return ke(t)?Er(t):{}}function ne(t){return Kr[t]}function oe(){var t=(t=y.indexOf)===sn?e:t;return t}function ie(t){return function(e,n,r,o){return"boolean"!=typeof n&&null!=n&&(o=r,r=o&&o[n]===e?v:n,n=!1),null!=r&&(r=y.createCallback(r,o)),t(e,n,r,o)}}function se(t){var e,n;return!t||wr.call(t)!=W||(e=t.constructor,we(e)&&!(e instanceof e))||!Mr.argsClass&&ue(t)||!Mr.nodeClass&&l(t)?!1:Mr.ownLast?(Yr(t,function(t,e,r){return n=vr.call(r,e),!1}),n!==!1):(Yr(t,function(t,e){n=e}),n===v||vr.call(t,n))}function ae(t){return Gr[t]}function ue(t){return wr.call(t)==B}function ce(t,e,n,r,o,i){var s=t;if("boolean"!=typeof e&&null!=e&&(r=n,n=e,e=!1),"function"==typeof n){if(n="undefined"==typeof r?n:y.createCallback(n,r,1),s=n(s),"undefined"!=typeof s)return s;s=t}var a=ke(s);if(a){var c=wr.call(s);if(!J[c]||!Mr.nodeClass&&l(s))return s;var f=$r(s)}if(!a||!e)return a?f?d(s):Wr({},s):s;var h=Lr[c];switch(c){case H:case z:return new h(+s);case G:case Y:return new h(s);case X:return h(s.source,C.exec(s))}var m=!o;o||(o=u()),i||(i=u());for(var g=o.length;g--;)if(o[g]==t)return i[g];return s=f?h(s.length):{},f&&(vr.call(t,"index")&&(s.index=t.index),vr.call(t,"input")&&(s.input=t.input)),o.push(t),i.push(s),(f?Vr:Jr)(t,function(t,r){s[r]=ce(t,e,n,v,o,i)}),m&&(p(o),p(i)),s}function le(t,e,n){return ce(t,!0,e,n)}function fe(t,e,n){var r;return e=y.createCallback(e,n),Jr(t,function(t,n,o){return e(t,n,o)?(r=n,!1):void 0}),r}function pe(t){var e=[];return Yr(t,function(t,n){we(t)&&e.push(n)}),e.sort()}function he(t,e){return t?vr.call(t,e):!1}function de(t){for(var e=-1,n=zr(t),r=n.length,o={};++e<r;){var i=n[e];o[t[i]]=i}return o}function me(t){return t===!0||t===!1||wr.call(t)==H}function ve(t){return t?"object"==typeof t&&wr.call(t)==z:!1}function ye(t){return t?1===t.nodeType:!1}function ge(t){var e=!0;if(!t)return e;var n=wr.call(t),r=t.length;return n==$||n==Y||(Mr.argsClass?n==B:ue(t))||n==W&&"number"==typeof r&&we(t.splice)?!r:(Jr(t,function(){return e=!1}),e)}function _e(t,e,n,r,o,i){var s=n===b;if("function"==typeof n&&!s){n=y.createCallback(n,r,2);var a=n(t,e);if("undefined"!=typeof a)return!!a}if(t===e)return 0!==t||1/t==1/e;var c=typeof t,f=typeof e;if(t===t&&(!t||"function"!=c&&"object"!=c)&&(!e||"function"!=f&&"object"!=f))return!1;if(null==t||null==e)return t===e;var h=wr.call(t),d=wr.call(e);if(h==B&&(h=W),d==B&&(d=W),h!=d)return!1;switch(h){case H:case z:return+t==+e;case G:return t!=+t?e!=+e:0==t?1/t==1/e:t==+e;case X:case Y:return t==nr(e)}var m=h==$;if(!m){if(vr.call(t,"__wrapped__ ")||vr.call(e,"__wrapped__"))return _e(t.__wrapped__||t,e.__wrapped__||e,n,r,o,i);if(h!=W||!Mr.nodeClass&&(l(t)||l(e)))return!1;var v=!Mr.argsObject&&ue(t)?tr:t.constructor,g=!Mr.argsObject&&ue(e)?tr:e.constructor;if(v!=g&&!(we(v)&&v instanceof v&&we(g)&&g instanceof g))return!1}var _=!o;o||(o=u()),i||(i=u());for(var w=o.length;w--;)if(o[w]==t)return i[w]==e;var k=0;if(a=!0,o.push(t),i.push(e),m){if(w=t.length,k=e.length,a=k==t.length,!a&&!s)return a;for(;k--;){var E=w,S=e[k];if(s)for(;E--&&!(a=_e(t[E],S,n,r,o,i)););else if(!(a=_e(t[k],S,n,r,o,i)))break}return a}return Yr(e,function(e,s,u){return vr.call(u,s)?(k++,a=vr.call(t,s)&&_e(t[s],e,n,r,o,i)):void 0}),a&&!s&&Yr(t,function(t,e,n){return vr.call(n,e)?a=--k>-1:void 0}),_&&(p(o),p(i)),a}function be(t){return xr(t)&&!Ar(parseFloat(t))}function we(t){return"function"==typeof t}function ke(t){return!(!t||!Q[typeof t])}function Ee(t){return xe(t)&&t!=+t}function Se(t){return null===t}function xe(t){return"number"==typeof t||wr.call(t)==G}function Ae(t){return!(!t||!Q[typeof t])&&wr.call(t)==X}function je(t){return"string"==typeof t||wr.call(t)==Y}function Oe(t){return"undefined"==typeof t}function Ie(t,e,n){var r=arguments,o=0,i=2;if(!ke(t))return t;if(n===b)var s=r[3],a=r[4],c=r[5];else{var l=!0;a=u(),c=u(),"number"!=typeof n&&(i=r.length),i>3&&"function"==typeof r[i-2]?s=y.createCallback(r[--i-1],r[i--],2):i>2&&"function"==typeof r[i-1]&&(s=r[--i])}for(;++o<i;)($r(r[o])?Be:Jr)(r[o],function(e,n){var r,o,i=e,u=t[n];if(e&&((o=$r(e))||Qr(e))){for(var l=a.length;l--;)if(r=a[l]==e){u=c[l];break}if(!r){var f;s&&(i=s(u,e),(f="undefined"!=typeof i)&&(u=i)),f||(u=o?$r(u)?u:[]:Qr(u)?u:{}),a.push(e),c.push(u),f||(u=Ie(u,e,b,s,a,c))}}else s&&(i=s(u,e),"undefined"==typeof i&&(i=e)),"undefined"!=typeof i&&(u=i);t[n]=u});return l&&(p(a),p(c)),t}function Ce(t,e,n){var r=oe(),o="function"==typeof e,i={};if(o)e=y.createCallback(e,n);else var s=pr.apply(or,Rr.call(arguments,1));return Yr(t,function(t,n,a){(o?!e(t,n,a):r(s,n)<0)&&(i[n]=t)}),i}function Te(t){for(var e=-1,n=zr(t),r=n.length,o=Gn(r);++e<r;){var i=n[e];o[e]=[i,t[i]]}return o}function Re(t,e,n){var r={};if("function"!=typeof e)for(var o=-1,i=pr.apply(or,Rr.call(arguments,1)),s=ke(t)?i.length:0;++o<s;){var a=i[o];a in t&&(r[a]=t[a])}else e=y.createCallback(e,n),Yr(t,function(t,n,o){e(t,n,o)&&(r[n]=t)});return r}function Ne(t,e,n,r){var o=$r(t);if(e=y.createCallback(e,r,4),null==n)if(o)n=[];else{var i=t&&t.constructor,s=i&&i.prototype;n=te(s)}return(o?Vr:Jr)(t,function(t,r,o){return e(n,t,r,o)}),n}function Pe(t){for(var e=-1,n=zr(t),r=n.length,o=Gn(r);++e<r;)o[e]=t[n[e]];return o}function Le(t){var e=-1,n=pr.apply(or,Rr.call(arguments,1)),r=n.length,o=Gn(r);for(Mr.unindexedChars&&je(t)&&(t=t.split(""));++e<r;)o[e]=t[n[e]];return o}function De(t,e,n){var r=-1,o=oe(),i=t?t.length:0,s=!1;return n=(0>n?Or(0,i+n):n)||0,i&&"number"==typeof i?s=(je(t)?t.indexOf(e,n):o(t,e,n))>-1:Vr(t,function(t){return++r>=n?!(s=t===e):void 0}),s}function Me(t,e,n){var r={};return e=y.createCallback(e,n),Be(t,function(t,n,o){n=nr(e(t,n,o)),vr.call(r,n)?r[n]++:r[n]=1}),r}function qe(t,e,n){var r=!0;if(e=y.createCallback(e,n),$r(t))for(var o=-1,i=t.length;++o<i&&(r=!!e(t[o],o,t)););else Vr(t,function(t,n,o){return r=!!e(t,n,o)});return r}function Ue(t,e,n){var r=[];if(e=y.createCallback(e,n),$r(t))for(var o=-1,i=t.length;++o<i;){var s=t[o];e(s,o,t)&&r.push(s)}else Vr(t,function(t,n,o){e(t,n,o)&&r.push(t)});return r}function Fe(t,e,n){if(e=y.createCallback(e,n),!$r(t)){var r;return Vr(t,function(t,n,o){return e(t,n,o)?(r=t,!1):void 0}),r}for(var o=-1,i=t.length;++o<i;){var s=t[o];if(e(s,o,t))return s}}function Be(t,e,n){if(e&&"undefined"==typeof n&&$r(t))for(var r=-1,o=t.length;++r<o&&e(t[r],r,t)!==!1;);else Vr(t,e,n);return t}function $e(t,e,n){var r={};return e=y.createCallback(e,n),Be(t,function(t,n,o){n=nr(e(t,n,o)),(vr.call(r,n)?r[n]:r[n]=[]).push(t)}),r}function He(t,e){var n=Rr.call(arguments,2),r=-1,o="function"==typeof e,i=t?t.length:0,s=Gn("number"==typeof i?i:0);return Be(t,function(t){s[++r]=(o?e:t[e]).apply(t,n)}),s}function ze(t,e,n){var r=-1,o=t?t.length:0,i=Gn("number"==typeof o?o:0);if(e=y.createCallback(e,n),$r(t))for(;++r<o;)i[r]=e(t[r],r,t);else Vr(t,function(t,n,o){i[++r]=e(t,n,o)});return i}function Ve(t,e,n){var r=-1/0,i=r;if(!e&&$r(t))for(var s=-1,a=t.length;++s<a;){var u=t[s];u>i&&(i=u)}else e=!e&&je(t)?o:y.createCallback(e,n),Vr(t,function(t,n,o){var s=e(t,n,o);s>r&&(r=s,i=t)});return i}function Ke(t,e,n){var r=1/0,i=r;if(!e&&$r(t))for(var s=-1,a=t.length;++s<a;){var u=t[s];i>u&&(i=u)}else e=!e&&je(t)?o:y.createCallback(e,n),Vr(t,function(t,n,o){var s=e(t,n,o);r>s&&(r=s,i=t)});return i}function Ge(t,e,n,r){var o=arguments.length<3;if(e=y.createCallback(e,r,4),$r(t)){var i=-1,s=t.length;for(o&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t)}else Vr(t,function(t,r,i){n=o?(o=!1,t):e(n,t,r,i)});return n}function We(t,e,n,r){var o=t,i=t?t.length:0,s=arguments.length<3;if("number"!=typeof i){var a=zr(t);i=a.length}else Mr.unindexedChars&&je(t)&&(o=t.split(""));return e=y.createCallback(e,r,4),Be(t,function(t,r,u){r=a?a[--i]:--i,n=s?(s=!1,o[r]):e(n,o[r],r,u)}),n}function Xe(t,e,n){return e=y.createCallback(e,n),Ue(t,function(t,n,r){return!e(t,n,r)})}function Ye(t){var e=-1,n=t?t.length:0,r=Gn("number"==typeof n?n:0);return Be(t,function(t){var n=hr(Tr()*(++e+1));r[e]=r[n],r[n]=t}),r}function Je(t){var e=t?t.length:0;return"number"==typeof e?e:zr(t).length}function Qe(t,e,n){var r;if(e=y.createCallback(e,n),$r(t))for(var o=-1,i=t.length;++o<i&&!(r=e(t[o],o,t)););else Vr(t,function(t,n,o){return!(r=e(t,n,o))});return!!r}function Ze(t,e,n){var r=-1,o=t?t.length:0,s=Gn("number"==typeof o?o:0);for(e=y.createCallback(e,n),Be(t,function(t,n,o){var i=s[++r]=c();i.criteria=e(t,n,o),i.index=r,i.value=t}),o=s.length,s.sort(i);o--;){var a=s[o];s[o]=a.value,h(a)}return s}function tn(t){return t&&"number"==typeof t.length?Mr.unindexedChars&&je(t)?t.split(""):d(t):Pe(t)}function en(t){for(var e=-1,n=t?t.length:0,r=[];++e<n;){var o=t[e];o&&r.push(o)}return r}function nn(t){var r=-1,o=oe(),i=t?t.length:0,a=pr.apply(or,Rr.call(arguments,1)),u=[],c=i>=E&&o===e;if(c){var l=s(a);l?(o=n,a=l):c=!1}for(;++r<i;){var f=t[r];o(a,f)<0&&u.push(f)}return c&&h(a),u}function rn(t,e,n){var r=-1,o=t?t.length:0;for(e=y.createCallback(e,n);++r<o;)if(e(t[r],r,t))return r;return-1}function on(t,e,n){if(t){var r=0,o=t.length;if("number"!=typeof e&&null!=e){var i=-1;for(e=y.createCallback(e,n);++i<o&&e(t[i],i,t);)r++}else if(r=e,null==r||n)return t[0];return d(t,0,Ir(Or(0,r),o))}}function sn(t,n,r){if("number"==typeof r){var o=t?t.length:0;r=0>r?Or(0,o+r):r||0}else if(r){var i=hn(t,n);return t[i]===n?i:-1}return t?e(t,n,r):-1}function an(t,e,n){if(!t)return[];var r=0,o=t.length;if("number"!=typeof e&&null!=e){var i=o;for(e=y.createCallback(e,n);i--&&e(t[i],i,t);)r++}else r=null==e||n?1:e||r;return d(t,0,Ir(Or(0,o-r),o))}function un(t){for(var r=arguments,o=r.length,i=-1,a=u(),c=-1,l=oe(),f=t?t.length:0,d=[],m=u();++i<o;){var v=r[i];a[i]=l===e&&(v?v.length:0)>=E&&s(i?r[i]:m)}t:for(;++c<f;){var y=a[0];if(v=t[c],(y?n(y,v):l(m,v))<0){for(i=o,(y||m).push(v);--i;)if(y=a[i],(y?n(y,v):l(r[i],v))<0)continue t;d.push(v)}}for(;o--;)y=a[o],y&&h(y);return p(a),p(m),d}function cn(t,e,n){if(t){var r=0,o=t.length;if("number"!=typeof e&&null!=e){var i=o;for(e=y.createCallback(e,n);i--&&e(t[i],i,t);)r++}else if(r=e,null==r||n)return t[o-1];return d(t,Or(0,o-r))}}function ln(t,e,n){var r=t?t.length:0;for("number"==typeof n&&(r=(0>n?Or(0,r+n):Ir(n,r-1))+1);r--;)if(t[r]===e)return r;return-1}function fn(t,e,n){t=+t||0,n=+n||1,null==e&&(e=t,t=0);for(var r=-1,o=Or(0,lr((e-t)/n)),i=Gn(o);++r<o;)i[r]=t,t+=n;return i}function pn(t,e,n){if("number"!=typeof e&&null!=e){var r=0,o=-1,i=t?t.length:0;for(e=y.createCallback(e,n);++o<i&&e(t[o],o,t);)r++}else r=null==e||n?1:Or(0,e);return d(t,r)}function hn(t,e,n,r){var o=0,i=t?t.length:o;for(n=n?y.createCallback(n,r,1):Ln,e=n(e);i>o;){var s=o+i>>>1;n(t[s])<e?o=s+1:i=s}return o}function dn(t){return $r(t)||(arguments[0]=t?Rr.call(t):or),no(pr.apply(or,arguments))}function mn(t){for(var e=-1,n=t?Ve(Zr(t,"length")):0,r=Gn(0>n?0:n);++e<n;)r[e]=Zr(t,e);return r}function vn(t){return nn(t,Rr.call(arguments,1))}function yn(t){return t?mn(arguments):[]}function gn(t,e){for(var n=-1,r=t?t.length:0,o={};++n<r;){var i=t[n];e?o[i]=e[n]:o[i[0]]=i[1]}return o}function _n(t,e){return 1>t?e():function(){return--t<1?e.apply(this,arguments):void 0}}function bn(t,e){return Mr.fastBind||kr&&arguments.length>2?kr.call.apply(kr,arguments):S(t,e,Rr.call(arguments,2))}function wn(t){for(var e=arguments.length>1?pr.apply(or,Rr.call(arguments,1)):pe(t),n=-1,r=e.length;++n<r;){var o=e[n];t[o]=bn(t[o],t)}return t}function kn(t,e){return S(t,e,Rr.call(arguments,2),b)}function En(){var t=arguments;return function(){for(var e=arguments,n=t.length;n--;)e=[t[n].apply(this,e)];return e[0]}}function Sn(t,e,n){if(null==t)return Ln;var r=typeof t;if("function"!=r){if("object"!=r)return function(e){return e[t]};var o=zr(t);return function(e){for(var n=o.length,r=!1;n--&&(r=_e(e[o[n]],t[o[n]],b)););return r}}return"undefined"==typeof e||R&&!R.test(dr.call(t))?t:1===n?function(n){return t.call(e,n)}:2===n?function(n,r){return t.call(e,n,r)}:4===n?function(n,r,o,i){return t.call(e,n,r,o,i)}:function(n,r,o){return t.call(e,n,r,o)}}function xn(t,e,n){function r(){fr(p),fr(h),c=0,p=h=null}function o(){var e=d&&(!m||c>1);r(),e&&(f!==!1&&(l=new Xn),a=t.apply(u,s))}function i(){r(),(d||f!==e)&&(l=new Xn,a=t.apply(u,s))}var s,a,u,c=0,l=0,f=!1,p=null,h=null,d=!0;if(e=Or(0,e||0),n===!0){var m=!0;d=!1}else ke(n)&&(m=n.leading,f="maxWait"in n&&Or(e,n.maxWait||0),d="trailing"in n?n.trailing:d);return function(){if(s=arguments,u=this,c++,fr(h),f===!1)m&&2>c&&(a=t.apply(u,s));else{var n=new Xn;p||m||(l=n);var r=f-(n-l);0>=r?(fr(p),p=null,l=n,a=t.apply(u,s)):p||(p=br(i,r))}return e!==f&&(h=br(o,e)),a}}function An(t){var e=Rr.call(arguments,1);return br(function(){t.apply(v,e)},1)}function jn(t,e){var n=Rr.call(arguments,2);return br(function(){t.apply(v,n)},e)}function On(t,e){function n(){var r=n.cache,o=w+(e?e.apply(this,arguments):arguments[0]);return vr.call(r,o)?r[o]:r[o]=t.apply(this,arguments)}return n.cache={},n}function In(t){var e,n;return function(){return e?n:(e=!0,n=t.apply(this,arguments),t=null,n)}}function Cn(t){return S(t,Rr.call(arguments,1))}function Tn(t){return S(t,Rr.call(arguments,1),null,b)}function Rn(t,e,n){var r=!0,o=!0;n===!1?r=!1:ke(n)&&(r="leading"in n?n.leading:r,o="trailing"in n?n.trailing:o),n=c(),n.leading=r,n.maxWait=e,n.trailing=o;var i=xn(t,e,n);return h(n),i}function Nn(t,e){return function(){var n=[t];return yr.apply(n,arguments),e.apply(this,n)}}function Pn(t){return null==t?"":nr(t).replace(D,ne)}function Ln(t){return t}function Dn(t){Be(pe(t),function(e){var n=y[e]=t[e];y.prototype[e]=function(){var t=this.__wrapped__,e=[t];yr.apply(e,arguments);var r=n.apply(y,e);return t&&"object"==typeof t&&t===r?this:new g(r)}})}function Mn(){return r._=ur,this}function qn(t,e){null==t&&null==e&&(e=1),t=+t||0,null==e?(e=t,t=0):e=+e||0;var n=Tr();return t%1||e%1?t+Ir(n*(e-t+parseFloat("1e-"+((n+"").length-1))),e):t+hr(n*(e-t+1))}function Un(t,e){var n=t?t[e]:v;return we(n)?t[e]():n}function Fn(t,e,n){var r=y.templateSettings;t||(t=""),n=Xr({},n,r);var o,i=Xr({},n.imports,r.imports),s=zr(i),u=Pe(i),c=0,l=n.interpolate||L,f="__p += '",p=er((n.escape||L).source+"|"+l.source+"|"+(l===T?I:L).source+"|"+(n.evaluate||L).source+"|$","g");t.replace(p,function(e,n,r,i,s,u){return r||(r=i),f+=t.slice(c,u).replace(M,a),n&&(f+="' +\n__e("+n+") +\n'"),s&&(o=!0,f+="';\n"+s+";\n__p += '"),r&&(f+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),c=u+e.length,e}),f+="';\n";var h=n.variable,d=h;d||(h="obj",f="with ("+h+") {\n"+f+"\n}\n"),f=(o?f.replace(x,""):f).replace(A,"$1").replace(j,"$1;"),f="function("+h+") {\n"+(d?"":h+" || ("+h+" = {});\n")+"var __t, __p = '', __e = _.escape"+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+f+"return __p\n}";var m="\n/*\n//@ sourceURL="+(n.sourceURL||"/lodash/template/source["+F++ +"]")+"\n*/";try{var g=Jn(s,"return "+f+m).apply(v,u)}catch(_){throw _.source=f,_}return e?g(e):(g.source=f,g)}function Bn(t,e,n){t=(t=+t)>-1?t:0;var r=-1,o=Gn(t);for(e=y.createCallback(e,n,1);++r<t;)o[r]=e(r);return o}function $n(t){return null==t?"":nr(t).replace(O,ae)}function Hn(t){var e=++_;return nr(null==t?"":t)+e}function zn(t,e){return e(t),t}function Vn(){return nr(this.__wrapped__)}function Kn(){return this.__wrapped__}r=r?re.defaults(t.Object(),r,re.pick(t,q)):t;var Gn=r.Array,Wn=r.Boolean,Xn=r.Date,Yn=r.Error,Jn=r.Function,Qn=r.Math,Zn=r.Number,tr=r.Object,er=r.RegExp,nr=r.String,rr=r.TypeError,or=[],ir=Yn.prototype,sr=tr.prototype,ar=nr.prototype,ur=r._,cr=er("^"+nr(sr.valueOf).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/valueOf|for [^\]]+/g,".+?")+"$"),lr=Qn.ceil,fr=r.clearTimeout,pr=or.concat,hr=Qn.floor,dr=Jn.prototype.toString,mr=cr.test(mr=tr.getPrototypeOf)&&mr,vr=sr.hasOwnProperty,yr=or.push,gr=sr.propertyIsEnumerable,_r=r.setImmediate,br=r.setTimeout,wr=sr.toString,kr=cr.test(kr=wr.bind)&&kr,Er=cr.test(Er=tr.create)&&Er,Sr=cr.test(Sr=Gn.isArray)&&Sr,xr=r.isFinite,Ar=r.isNaN,jr=cr.test(jr=tr.keys)&&jr,Or=Qn.max,Ir=Qn.min,Cr=r.parseInt,Tr=Qn.random,Rr=or.slice,Nr=cr.test(r.attachEvent),Pr=kr&&!/\n|true/.test(kr+Nr),Lr={};Lr[$]=Gn,Lr[H]=Wn,Lr[z]=Xn,Lr[K]=Jn,Lr[W]=tr,Lr[G]=Zn,Lr[X]=er,Lr[Y]=nr;var Dr={};Dr[$]=Dr[z]=Dr[G]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Dr[H]=Dr[Y]={constructor:!0,toString:!0,valueOf:!0},Dr[V]=Dr[K]=Dr[X]={constructor:!0,toString:!0},Dr[W]={constructor:!0},function(){for(var t=U.length;t--;){var e=U[t];for(var n in Dr)vr.call(Dr,n)&&!vr.call(Dr[n],e)&&(Dr[n][e]=!1)}}(),g.prototype=y.prototype;var Mr=y.support={};!function(){var t=function(){this.x=1},e={0:1,length:1},n=[];t.prototype={valueOf:1,y:1};for(var r in new t)n.push(r);for(r in arguments);Mr.argsObject=arguments.constructor==tr&&!(arguments instanceof Gn),Mr.argsClass=ue(arguments),Mr.enumErrorProps=gr.call(ir,"message")||gr.call(ir,"name"),Mr.enumPrototypes=gr.call(t,"prototype"),Mr.fastBind=kr&&!Pr,Mr.ownLast="x"!=n[0],Mr.nonEnumArgs=0!=r,Mr.nonEnumShadows=!/valueOf/.test(n),Mr.spliceObjects=(or.splice.call(e,0,1),!e[0]),Mr.unindexedChars="xx"!="x"[0]+tr("x")[0];try{Mr.nodeClass=!(wr.call(document)==W&&!({toString:0}+""))}catch(o){Mr.nodeClass=!0}}(1),y.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:T,variable:"",imports:{_:y}};var qr=function(t){var e="var index, iterable = "+t.firstArg+", result = "+t.init+";\nif (!iterable) return result;\n"+t.top+";";t.array?(e+="\nvar length = iterable.length; index = -1;\nif ("+t.array+") {  ",Mr.unindexedChars&&(e+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),e+="\n  while (++index < length) {\n    "+t.loop+";\n  }\n}\nelse {  "):Mr.nonEnumArgs&&(e+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+t.loop+";\n    }\n  } else {  "),Mr.enumPrototypes&&(e+="\n  var skipProto = typeof iterable == 'function';\n  "),Mr.enumErrorProps&&(e+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];if(Mr.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),Mr.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))'),t.useHas&&t.useKeys)e+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }  ";else if(e+="\n  for (index in iterable) {\n",t.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(e+="    if ("+n.join(" && ")+") {\n  "),e+=t.loop+";    ",n.length&&(e+="\n    }"),e+="\n  }    ",Mr.nonEnumShadows){for(e+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;7>k;k++)e+="\n    index = '"+t.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",t.useHas||(e+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),e+=") {\n      "+t.loop+";\n    }      ";e+="\n  }    "}return(t.array||Mr.nonEnumArgs)&&(e+="\n}"),e+=t.bottom+";\nreturn result"},Ur={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Fr={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : lodash.createCallback(callback, thisArg)",array:"typeof length == 'number'",loop:"if (callback(iterable[index], index, collection) === false) return result"},Br={top:"if (!objectTypes[typeof iterable]) return result;\n"+Fr.top,array:!1};if(!Er)var te=function(t){if(ke(t)){f.prototype=t;var e=new f;f.prototype=null}return e||{}};Mr.argsClass||(ue=function(t){return t?vr.call(t,"callee"):!1});var $r=Sr||function(t){return t?"object"==typeof t&&wr.call(t)==$:!1},Hr=Z({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),zr=jr?function(t){return ke(t)?Mr.enumPrototypes&&"function"==typeof t||Mr.nonEnumArgs&&t.length&&ue(t)?Hr(t):jr(t):[]}:Hr,Vr=Z(Fr),Kr={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Gr=de(Kr),Wr=Z(Ur,{top:Ur.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = lodash.createCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),Xr=Z(Ur),Yr=Z(Fr,Br,{useHas:!1}),Jr=Z(Fr,Br);we(/x/)&&(we=function(t){return"function"==typeof t&&wr.call(t)==K});var Qr=mr?function(t){if(!t||wr.call(t)!=W||!Mr.argsClass&&ue(t))return!1;var e=t.valueOf,n="function"==typeof e&&(n=mr(e))&&mr(n);return n?t==n||mr(t)==n:se(t)}:se,Zr=ze,to=Ue,eo=ie(function oo(t,e,n){for(var r=-1,o=t?t.length:0,i=[];++r<o;){var s=t[r];n&&(s=n(s,r,t)),$r(s)?yr.apply(i,e?s:oo(s)):i.push(s)}return i}),no=ie(function(t,r,o){var i=-1,a=oe(),c=t?t.length:0,l=[],f=!r&&c>=E&&a===e,d=o||f?u():l;if(f){var m=s(d);m?(a=n,d=m):(f=!1,d=o?d:(p(d),l))}for(;++i<c;){var v=t[i],y=o?o(v,i,t):v;(r?!i||d[d.length-1]!==y:a(d,y)<0)&&((o||f)&&d.push(y),l.push(v))}return f?(p(d.array),h(d)):o&&p(d),l});Pr&&ee&&"function"==typeof _r&&(An=bn(_r,r));var ro=8==Cr(N+"08")?Cr:function(t,e){return Cr(je(t)?t.replace(P,""):t,e||0)};return y.after=_n,y.assign=Wr,y.at=Le,y.bind=bn,y.bindAll=wn,y.bindKey=kn,y.compact=en,y.compose=En,y.countBy=Me,y.createCallback=Sn,y.debounce=xn,y.defaults=Xr,y.defer=An,y.delay=jn,y.difference=nn,y.filter=Ue,y.flatten=eo,y.forEach=Be,y.forIn=Yr,y.forOwn=Jr,y.functions=pe,y.groupBy=$e,y.initial=an,y.intersection=un,y.invert=de,y.invoke=He,y.keys=zr,y.map=ze,y.max=Ve,y.memoize=On,y.merge=Ie,y.min=Ke,y.omit=Ce,y.once=In,y.pairs=Te,y.partial=Cn,y.partialRight=Tn,y.pick=Re,y.pluck=Zr,y.range=fn,y.reject=Xe,y.rest=pn,y.shuffle=Ye,y.sortBy=Ze,y.tap=zn,y.throttle=Rn,y.times=Bn,y.toArray=tn,y.transform=Ne,y.union=dn,y.uniq=no,y.unzip=mn,y.values=Pe,y.where=to,y.without=vn,y.wrap=Nn,y.zip=yn,y.zipObject=gn,y.collect=ze,y.drop=pn,y.each=Be,y.extend=Wr,y.methods=pe,y.object=gn,y.select=Ue,y.tail=pn,y.unique=no,Dn(y),y.chain=y,y.prototype.chain=function(){return this},y.clone=ce,y.cloneDeep=le,y.contains=De,y.escape=Pn,y.every=qe,y.find=Fe,y.findIndex=rn,y.findKey=fe,y.has=he,y.identity=Ln,y.indexOf=sn,y.isArguments=ue,y.isArray=$r,y.isBoolean=me,y.isDate=ve,y.isElement=ye,y.isEmpty=ge,y.isEqual=_e,y.isFinite=be,y.isFunction=we,y.isNaN=Ee,y.isNull=Se,y.isNumber=xe,y.isObject=ke,y.isPlainObject=Qr,y.isRegExp=Ae,y.isString=je,y.isUndefined=Oe,y.lastIndexOf=ln,y.mixin=Dn,y.noConflict=Mn,y.parseInt=ro,y.random=qn,y.reduce=Ge,y.reduceRight=We,y.result=Un,y.runInContext=m,y.size=Je,y.some=Qe,y.sortedIndex=hn,y.template=Fn,y.unescape=$n,y.uniqueId=Hn,y.all=qe,y.any=Qe,y.detect=Fe,y.findWhere=Fe,y.foldl=Ge,y.foldr=We,y.include=De,y.inject=Ge,Jr(y,function(t,e){y.prototype[e]||(y.prototype[e]=function(){var e=[this.__wrapped__];return yr.apply(e,arguments),t.apply(y,e)})}),y.first=on,y.last=cn,y.take=on,y.head=on,Jr(y,function(t,e){y.prototype[e]||(y.prototype[e]=function(e,n){var r=t(this.__wrapped__,e,n);return null==e||n&&"function"!=typeof e?r:new g(r)})}),y.VERSION="1.3.1",y.prototype.toString=Vn,y.prototype.value=Kn,y.prototype.valueOf=Kn,Vr(["join","pop","shift"],function(t){var e=or[t];y.prototype[t]=function(){return e.apply(this.__wrapped__,arguments)}}),Vr(["push","reverse","sort","unshift"],function(t){var e=or[t];y.prototype[t]=function(){return e.apply(this.__wrapped__,arguments),this}}),Vr(["concat","slice","splice"],function(t){var e=or[t];y.prototype[t]=function(){return new g(e.apply(this.__wrapped__,arguments))}}),Mr.spliceObjects||Vr(["pop","shift","splice"],function(t){var e=or[t],n="splice"==t;y.prototype[t]=function(){var t=this.__wrapped__,r=e.apply(t,arguments);return 0===t.length&&delete t[0],n?new g(r):r}}),y}var v,y=[],g=[],_=0,b={},w=+new Date+"",E=75,S=40,x=/\b__p \+= '';/g,A=/\b(__p \+=) '' \+/g,j=/(__e\(.*?\)|\b__t\)) \+\n'';/g,O=/&(?:amp|lt|gt|quot|#39);/g,I=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,C=/\w*$/,T=/<%=([\s\S]+?)%>/g,R=(R=/\bthis\b/)&&R.test(m)&&R,N=" 	\f ﻿\n\r\u2028\u2029 ᠎             　",P=RegExp("^["+N+"]*0+(?=.$)"),L=/($^)/,D=/[&<>"']/g,M=/['\n\r\t\u2028\u2029\\]/g,q=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setImmediate","setTimeout"],U=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],F=0,B="[object Arguments]",$="[object Array]",H="[object Boolean]",z="[object Date]",V="[object Error]",K="[object Function]",G="[object Number]",W="[object Object]",X="[object RegExp]",Y="[object String]",J={};J[K]=!1,J[B]=J[$]=J[H]=J[z]=J[G]=J[W]=J[X]=J[Y]=!0;var Q={"boolean":!1,"function":!0,object:!0,number:!1,string:!1,undefined:!1},Z={"\\":"\\","'":"'","\n":"n","\r":"r","	":"t","\u2028":"u2028","\u2029":"u2029"},te=Q[typeof exports]&&exports,ee=Q[typeof module]&&module&&module.exports==te&&module,ne=Q[typeof global]&&global;!ne||ne.global!==ne&&ne.window!==ne||(t=ne);var re=m();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(t._=re,define("lodash",[],function(){return re})):te&&!te.nodeType?ee?(ee.exports=re)._=re:te._=re:t._=re}(this),define("hide_lodash",["lodash"],function(t){t.noConflict()}),define("iefix",[],function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(t){var e=this.length>>>0,n=Number(arguments[1])||0;for(n=0>n?Math.ceil(n):Math.floor(n),0>n&&(n+=e);e>n;n++)if(n in this&&this[n]===t)return n;return-1})}),define("global/window",[],function(){return window}),!function(t){function e(){this._events={},this._conf&&n.call(this,this._conf)}function n(t){t&&(this._conf=t,t.delimiter&&(this.delimiter=t.delimiter),t.maxListeners&&(this._events.maxListeners=t.maxListeners),t.wildcard&&(this.wildcard=t.wildcard),t.newListener&&(this.newListener=t.newListener),this.wildcard&&(this.listenerTree={}))}function r(t){this._events={},this.newListener=!1,n.call(this,t)}function o(t,e,n,r){if(!n)return[];var i,s,a,u,c,l,f,p=[],h=e.length,d=e[r],m=e[r+1];if(r===h&&n._listeners){if("function"==typeof n._listeners)return t&&t.push(n._listeners),[n];for(i=0,s=n._listeners.length;s>i;i++)t&&t.push(n._listeners[i]);
return[n]}if("*"===d||"**"===d||n[d]){if("*"===d){for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&(p=p.concat(o(t,e,n[a],r+1)));return p}if("**"===d){f=r+1===h||r+2===h&&"*"===m,f&&n._listeners&&(p=p.concat(o(t,e,n,h)));for(a in n)"_listeners"!==a&&n.hasOwnProperty(a)&&("*"===a||"**"===a?(n[a]._listeners&&!f&&(p=p.concat(o(t,e,n[a],h))),p=p.concat(o(t,e,n[a],r))):p=a===m?p.concat(o(t,e,n[a],r+2)):p.concat(o(t,e,n[a],r)));return p}p=p.concat(o(t,e,n[d],r+1))}if(u=n["*"],u&&o(t,e,u,r+1),c=n["**"])if(h>r){c._listeners&&o(t,e,c,h);for(a in c)"_listeners"!==a&&c.hasOwnProperty(a)&&(a===m?o(t,e,c[a],r+2):a===d?o(t,e,c[a],r+1):(l={},l[a]=c[a],o(t,e,{"**":l},r+1)))}else c._listeners?o(t,e,c,h):c["*"]&&c["*"]._listeners&&o(t,e,c["*"],h);return p}function i(t,e){t="string"==typeof t?t.split(this.delimiter):t.slice();for(var n=0,r=t.length;r>n+1;n++)if("**"===t[n]&&"**"===t[n+1])return;for(var o=this.listenerTree,i=t.shift();i;){if(o[i]||(o[i]={}),o=o[i],0===t.length){if(o._listeners){if("function"==typeof o._listeners)o._listeners=[o._listeners,e];else if(s(o._listeners)&&(o._listeners.push(e),!o._listeners.warned)){var u=a;"undefined"!=typeof this._events.maxListeners&&(u=this._events.maxListeners),u>0&&o._listeners.length>u&&(o._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",o._listeners.length),console.trace())}}else o._listeners=e;return!0}i=t.shift()}return!0}var s=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)},a=10;r.prototype.delimiter=".",r.prototype.setMaxListeners=function(t){this._events||e.call(this),this._events.maxListeners=t,this._conf||(this._conf={}),this._conf.maxListeners=t},r.prototype.event="",r.prototype.once=function(t,e){return this.many(t,1,e),this},r.prototype.many=function(t,e,n){function r(){0===--e&&o.off(t,r),n.apply(this,arguments)}var o=this;if("function"!=typeof n)throw new Error("many only accepts instances of Function");return r._origin=n,this.on(t,r),o},r.prototype.emit=function(){this._events||e.call(this);var t=arguments[0];if("newListener"===t&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var n=arguments.length,r=new Array(n-1),i=1;n>i;i++)r[i-1]=arguments[i];for(i=0,n=this._all.length;n>i;i++)this.event=t,this._all[i].apply(this,r)}if("error"===t&&!(this._all||this._events.error||this.wildcard&&this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var s;if(this.wildcard){s=[];var a="string"==typeof t?t.split(this.delimiter):t.slice();o.call(this,s,a,this.listenerTree,0)}else s=this._events[t];if("function"==typeof s){if(this.event=t,1===arguments.length)s.call(this);else if(arguments.length>1)switch(arguments.length){case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:for(var n=arguments.length,r=new Array(n-1),i=1;n>i;i++)r[i-1]=arguments[i];s.apply(this,r)}return!0}if(s){for(var n=arguments.length,r=new Array(n-1),i=1;n>i;i++)r[i-1]=arguments[i];for(var u=s.slice(),i=0,n=u.length;n>i;i++)this.event=t,u[i].apply(this,r);return u.length>0||this._all}return this._all},r.prototype.on=function(t,n){if("function"==typeof t)return this.onAny(t),this;if("function"!=typeof n)throw new Error("on only accepts instances of Function");if(this._events||e.call(this),this.emit("newListener",t,n),this.wildcard)return i.call(this,t,n),this;if(this._events[t]){if("function"==typeof this._events[t])this._events[t]=[this._events[t],n];else if(s(this._events[t])&&(this._events[t].push(n),!this._events[t].warned)){var r=a;"undefined"!=typeof this._events.maxListeners&&(r=this._events.maxListeners),r>0&&this._events[t].length>r&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),console.trace())}}else this._events[t]=n;return this},r.prototype.onAny=function(t){if(this._all||(this._all=[]),"function"!=typeof t)throw new Error("onAny only accepts instances of Function");return this._all.push(t),this},r.prototype.addListener=r.prototype.on,r.prototype.off=function(t,e){if("function"!=typeof e)throw new Error("removeListener only takes instances of Function");var n,r=[];if(this.wildcard){var i="string"==typeof t?t.split(this.delimiter):t.slice();r=o.call(this,null,i,this.listenerTree,0)}else{if(!this._events[t])return this;n=this._events[t],r.push({_listeners:n})}for(var a=0;a<r.length;a++){var u=r[a];if(n=u._listeners,s(n)){for(var c=-1,l=0,f=n.length;f>l;l++)if(n[l]===e||n[l].listener&&n[l].listener===e||n[l]._origin&&n[l]._origin===e){c=l;break}if(0>c)return this;this.wildcard?u._listeners.splice(c,1):this._events[t].splice(c,1),0===n.length&&(this.wildcard?delete u._listeners:delete this._events[t])}else(n===e||n.listener&&n.listener===e||n._origin&&n._origin===e)&&(this.wildcard?delete u._listeners:delete this._events[t])}return this},r.prototype.offAny=function(t){var e,n=0,r=0;if(t&&this._all&&this._all.length>0){for(e=this._all,n=0,r=e.length;r>n;n++)if(t===e[n])return e.splice(n,1),this}else this._all=[];return this},r.prototype.removeListener=r.prototype.off,r.prototype.removeAllListeners=function(t){if(0===arguments.length)return!this._events||e.call(this),this;if(this.wildcard)for(var n="string"==typeof t?t.split(this.delimiter):t.slice(),r=o.call(this,null,n,this.listenerTree,0),i=0;i<r.length;i++){var s=r[i];s._listeners=null}else{if(!this._events[t])return this;this._events[t]=null}return this},r.prototype.listeners=function(t){if(this.wildcard){var n=[],r="string"==typeof t?t.split(this.delimiter):t.slice();return o.call(this,n,r,this.listenerTree,0),n}return this._events||e.call(this),this._events[t]||(this._events[t]=[]),s(this._events[t])||(this._events[t]=[this._events[t]]),this._events[t]},r.prototype.listenersAny=function(){return this._all?this._all:[]},"function"==typeof define&&define.amd?define("eventemitter2",[],function(){return r}):t.EventEmitter2=r}("undefined"!=typeof process&&"undefined"!=typeof process.title&&"undefined"!=typeof exports?exports:window),function(){var t={};t.constructor=function(){};var e=this;t.register=function(){function t(t){return function(){o++||(e(),t&&t.apply(this,arguments))}}function e(){if(n){for(var t=0;r>t;t+=3){var e=n[t],o=n[t+1],i=n[t+2];e.removeListener?e.removeListener(o,i):e.off(o,i)}n=null}}var n=1===arguments.length?arguments[0]:arguments,r=n.length;if(0!==r%3)throw new Error("register needs triplets as arguments");for(var o=0,i=0;r>i;i+=3){var s=n[i],a=n[i+1],u=n[i+2];"!"==a.substr(0,1)&&(a=n[i+1]=a.substr(1),u=n[i+2]=t(u)),s.addListener?s.addListener(a,u):s.on(a,u)}return e},t.singular=function(t){return function(){if(t){var e=t;return t=null,e.apply(this,arguments)}}},"undefined"!=typeof define&&define.amd?define("eventutil",[],function(){return t}):"undefined"!=typeof module&&module.exports?module.exports=t:e.eventutil=t}(),define("global/json",["global/window"],function(t){return t.JSON}),function(){function t(t){var n=!1;return function(){if(n)throw new Error("Callback was already called.");n=!0,t.apply(e,arguments)}}var e,n,r={};e=this,null!=e&&(n=e.async),r.noConflict=function(){return e.async=n,r};var o=function(t,e){if(t.forEach)return t.forEach(e);for(var n=0;n<t.length;n+=1)e(t[n],n,t)},i=function(t,e){if(t.map)return t.map(e);var n=[];return o(t,function(t,r,o){n.push(e(t,r,o))}),n},s=function(t,e,n){return t.reduce?t.reduce(e,n):(o(t,function(t,r,o){n=e(n,t,r,o)}),n)},a=function(t){if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e};"undefined"!=typeof process&&process.nextTick?(r.nextTick=process.nextTick,r.setImmediate="undefined"!=typeof setImmediate?setImmediate:r.nextTick):"function"==typeof setImmediate?(r.nextTick=function(t){setImmediate(t)},r.setImmediate=r.nextTick):(r.nextTick=function(t){setTimeout(t,0)},r.setImmediate=r.nextTick),r.each=function(e,n,r){if(r=r||function(){},!e.length)return r();var i=0;o(e,function(o){n(o,t(function(t){t?(r(t),r=function(){}):(i+=1,i>=e.length&&r(null))}))})},r.forEach=r.each,r.eachSeries=function(t,e,n){if(n=n||function(){},!t.length)return n();var r=0,o=function(){e(t[r],function(e){e?(n(e),n=function(){}):(r+=1,r>=t.length?n(null):o())})};o()},r.forEachSeries=r.eachSeries,r.eachLimit=function(t,e,n,r){var o=u(e);o.apply(null,[t,n,r])},r.forEachLimit=r.eachLimit;var u=function(t){return function(e,n,r){if(r=r||function(){},!e.length||0>=t)return r();var o=0,i=0,s=0;!function a(){if(o>=e.length)return r();for(;t>s&&i<e.length;)i+=1,s+=1,n(e[i-1],function(t){t?(r(t),r=function(){}):(o+=1,s-=1,o>=e.length?r():a())})}()}},c=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[r.each].concat(e))}},l=function(t,e){return function(){var n=Array.prototype.slice.call(arguments);return e.apply(null,[u(t)].concat(n))}},f=function(t){return function(){var e=Array.prototype.slice.call(arguments);return t.apply(null,[r.eachSeries].concat(e))}},p=function(t,e,n,r){var o=[];e=i(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n,r){o[t.index]=r,e(n)})},function(t){r(t,o)})};r.map=c(p),r.mapSeries=f(p),r.mapLimit=function(t,e,n,r){return h(e)(t,n,r)};var h=function(t){return l(t,p)};r.reduce=function(t,e,n,o){r.eachSeries(t,function(t,r){n(e,t,function(t,n){e=n,r(t)})},function(t){o(t,e)})},r.inject=r.reduce,r.foldl=r.reduce,r.reduceRight=function(t,e,n,o){var s=i(t,function(t){return t}).reverse();r.reduce(s,e,n,o)},r.foldr=r.reduceRight;var d=function(t,e,n,r){var o=[];e=i(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n){n&&o.push(t),e()})},function(){r(i(o.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};r.filter=c(d),r.filterSeries=f(d),r.select=r.filter,r.selectSeries=r.filterSeries;var m=function(t,e,n,r){var o=[];e=i(e,function(t,e){return{index:e,value:t}}),t(e,function(t,e){n(t.value,function(n){n||o.push(t),e()})},function(){r(i(o.sort(function(t,e){return t.index-e.index}),function(t){return t.value}))})};r.reject=c(m),r.rejectSeries=f(m);var v=function(t,e,n,r){t(e,function(t,e){n(t,function(n){n?(r(t),r=function(){}):e()})},function(){r()})};r.detect=c(v),r.detectSeries=f(v),r.some=function(t,e,n){r.each(t,function(t,r){e(t,function(t){t&&(n(!0),n=function(){}),r()})},function(){n(!1)})},r.any=r.some,r.every=function(t,e,n){r.each(t,function(t,r){e(t,function(t){t||(n(!1),n=function(){}),r()})},function(){n(!0)})},r.all=r.every,r.sortBy=function(t,e,n){r.map(t,function(t,n){e(t,function(e,r){e?n(e):n(null,{value:t,criteria:r})})},function(t,e){if(t)return n(t);var r=function(t,e){var n=t.criteria,r=e.criteria;return r>n?-1:n>r?1:0};n(null,i(e.sort(r),function(t){return t.value}))})},r.auto=function(t,e){e=e||function(){};var n=a(t);if(!n.length)return e(null);var i={},u=[],c=function(t){u.unshift(t)},l=function(t){for(var e=0;e<u.length;e+=1)if(u[e]===t)return u.splice(e,1),void 0},f=function(){o(u.slice(0),function(t){t()})};c(function(){a(i).length===n.length&&(e(null,i),e=function(){})}),o(n,function(n){var u=t[n]instanceof Function?[t[n]]:t[n],p=function(t){var s=Array.prototype.slice.call(arguments,1);if(s.length<=1&&(s=s[0]),t){var u={};o(a(i),function(t){u[t]=i[t]}),u[n]=s,e(t,u),e=function(){}}else i[n]=s,r.setImmediate(f)},h=u.slice(0,Math.abs(u.length-1))||[],d=function(){return s(h,function(t,e){return t&&i.hasOwnProperty(e)},!0)&&!i.hasOwnProperty(n)};if(d())u[u.length-1](p,i);else{var m=function(){d()&&(l(m),u[u.length-1](p,i))};c(m)}})},r.waterfall=function(t,e){if(e=e||function(){},t.constructor!==Array){var n=new Error("First argument to waterfall must be an array of functions");return e(n)}if(!t.length)return e();var o=function(t){return function(n){if(n)e.apply(null,arguments),e=function(){};else{var i=Array.prototype.slice.call(arguments,1),s=t.next();s?i.push(o(s)):i.push(e),r.setImmediate(function(){t.apply(null,i)})}}};o(r.iterator(t))()};var y=function(t,e,n){if(n=n||function(){},e.constructor===Array)t.map(e,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},n);else{var r={};t.each(a(e),function(t,n){e[t](function(e){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]),r[t]=o,n(e)})},function(t){n(t,r)})}};r.parallel=function(t,e){y({map:r.map,each:r.each},t,e)},r.parallelLimit=function(t,e,n){y({map:h(e),each:u(e)},t,n)},r.series=function(t,e){if(e=e||function(){},t.constructor===Array)r.mapSeries(t,function(t,e){t&&t(function(t){var n=Array.prototype.slice.call(arguments,1);n.length<=1&&(n=n[0]),e.call(null,t,n)})},e);else{var n={};r.eachSeries(a(t),function(e,r){t[e](function(t){var o=Array.prototype.slice.call(arguments,1);o.length<=1&&(o=o[0]),n[e]=o,r(t)})},function(t){e(t,n)})}},r.iterator=function(t){var e=function(n){var r=function(){return t.length&&t[n].apply(null,arguments),r.next()};return r.next=function(){return n<t.length-1?e(n+1):null},r};return e(0)},r.apply=function(t){var e=Array.prototype.slice.call(arguments,1);return function(){return t.apply(null,e.concat(Array.prototype.slice.call(arguments)))}};var g=function(t,e,n,r){var o=[];t(e,function(t,e){n(t,function(t,n){o=o.concat(n||[]),e(t)})},function(t){r(t,o)})};r.concat=c(g),r.concatSeries=f(g),r.whilst=function(t,e,n){t()?e(function(o){return o?n(o):(r.whilst(t,e,n),void 0)}):n()},r.doWhilst=function(t,e,n){t(function(o){return o?n(o):(e()?r.doWhilst(t,e,n):n(),void 0)})},r.until=function(t,e,n){t()?n():e(function(o){return o?n(o):(r.until(t,e,n),void 0)})},r.doUntil=function(t,e,n){t(function(o){return o?n(o):(e()?n():r.doUntil(t,e,n),void 0)})},r.queue=function(e,n){function i(t,e,i,s){e.constructor!==Array&&(e=[e]),o(e,function(e){var o={data:e,callback:"function"==typeof s?s:null};i?t.tasks.unshift(o):t.tasks.push(o),t.saturated&&t.tasks.length===n&&t.saturated(),r.setImmediate(t.process)})}void 0===n&&(n=1);var s=0,a={tasks:[],concurrency:n,saturated:null,empty:null,drain:null,push:function(t,e){i(a,t,!1,e)},unshift:function(t,e){i(a,t,!0,e)},process:function(){if(s<a.concurrency&&a.tasks.length){var n=a.tasks.shift();a.empty&&0===a.tasks.length&&a.empty(),s+=1;var r=function(){s-=1,n.callback&&n.callback.apply(n,arguments),a.drain&&0===a.tasks.length+s&&a.drain(),a.process()},o=t(r);e(n.data,o)}},length:function(){return a.tasks.length},running:function(){return s}};return a},r.cargo=function(t,e){var n=!1,s=[],a={tasks:s,payload:e,saturated:null,empty:null,drain:null,push:function(t,n){t.constructor!==Array&&(t=[t]),o(t,function(t){s.push({data:t,callback:"function"==typeof n?n:null}),a.saturated&&s.length===e&&a.saturated()}),r.setImmediate(a.process)},process:function u(){if(!n){if(0===s.length)return a.drain&&a.drain(),void 0;var r="number"==typeof e?s.splice(0,e):s.splice(0),c=i(r,function(t){return t.data});a.empty&&a.empty(),n=!0,t(c,function(){n=!1;var t=arguments;o(r,function(e){e.callback&&e.callback.apply(null,t)}),u()})}},length:function(){return s.length},running:function(){return n}};return a};var _=function(t){return function(e){var n=Array.prototype.slice.call(arguments,1);e.apply(null,n.concat([function(e){var n=Array.prototype.slice.call(arguments,1);"undefined"!=typeof console&&(e?console.error&&console.error(e):console[t]&&o(n,function(e){console[t](e)}))}]))}};r.log=_("log"),r.dir=_("dir"),r.memoize=function(t,e){var n={},r={};e=e||function(t){return t};var o=function(){var o=Array.prototype.slice.call(arguments),i=o.pop(),s=e.apply(null,o);s in n?i.apply(null,n[s]):s in r?r[s].push(i):(r[s]=[i],t.apply(null,o.concat([function(){n[s]=arguments;var t=r[s];delete r[s];for(var e=0,o=t.length;o>e;e++)t[e].apply(null,arguments)}])))};return o.memo=n,o.unmemoized=t,o},r.unmemoize=function(t){return function(){return(t.unmemoized||t).apply(null,arguments)}},r.times=function(t,e,n){for(var o=[],i=0;t>i;i++)o.push(i);return r.map(o,e,n)},r.timesSeries=function(t,e,n){for(var o=[],i=0;t>i;i++)o.push(i);return r.mapSeries(o,e,n)},r.compose=function(){var t=Array.prototype.reverse.call(arguments);return function(){var e=this,n=Array.prototype.slice.call(arguments),o=n.pop();r.reduce(t,n,function(t,n,r){n.apply(e,t.concat([function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);r(t,e)}]))},function(t,n){o.apply(e,[t].concat(n))})}};var b=function(t,e){var n=function(){var n=this,r=Array.prototype.slice.call(arguments),o=r.pop();return t(e,function(t,e){t.apply(n,r.concat([e]))},o)};if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return n.apply(this,r)}return n};r.applyEach=c(b),r.applyEachSeries=f(b),r.forever=function(t,e){function n(r){if(r){if(e)return e(r);throw r}t(n)}n()},"undefined"!=typeof define&&define.amd?define("async",[],function(){return r}):"undefined"!=typeof module&&module.exports?module.exports=r:e.async=r}(),function(t){if("function"==typeof bootstrap)bootstrap("promise",t);else if("object"==typeof exports)module.exports=t();else if("function"==typeof define&&define.amd)define("Q",t);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=t}else Q=t()}(function(){function t(t){return function(){return X.apply(t,arguments)}}function e(t){return t===Object(t)}function n(t){return"[object StopIteration]"===re(t)||t instanceof V}function r(t,e){if($&&e.stack&&"object"==typeof t&&null!==t&&t.stack&&-1===t.stack.indexOf(ie)){for(var n=[],r=e;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(t.stack);var i=n.join("\n"+ie+"\n");t.stack=o(i)}}function o(t){for(var e=t.split("\n"),n=[],r=0;r<e.length;++r){var o=e[r];a(o)||i(o)||!o||n.push(o)}return n.join("\n")}function i(t){return-1!==t.indexOf("(module.js:")||-1!==t.indexOf("(node.js:")}function s(t){var e=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(t);if(e)return[e[1],Number(e[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(t);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(t);return r?[r[1],Number(r[2])]:void 0}function a(t){var e=s(t);if(!e)return!1;var n=e[0],r=e[1];return n===z&&r>=K&&le>=r}function u(){if($)try{throw new Error}catch(t){var e=t.stack.split("\n"),n=e[0].indexOf("@")>0?e[1]:e[2],r=s(n);if(!r)return;return z=r[0],r[1]}}function c(t,e,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(e+" is deprecated, use "+n+" instead.",new Error("").stack),t.apply(t,arguments)}}function l(t){return y(t)?t:g(t)?I(t):O(t)}function f(){function t(t){e=t,i.source=t,J(n,function(e,n){W(function(){t.promiseDispatch.apply(t,n)})},void 0),n=void 0,r=void 0}var e,n=[],r=[],o=te(f.prototype),i=te(d.prototype);if(i.promiseDispatch=function(t,o,i){var s=Y(arguments);n?(n.push(s),"when"===o&&i[1]&&r.push(i[1])):W(function(){e.promiseDispatch.apply(e,s)})},i.valueOf=c(function(){if(n)return i;var t=v(e);return y(t)&&(e=t),t},"valueOf","inspect"),i.inspect=function(){return e?e.inspect():{state:"pending"}},l.longStackSupport&&$)try{throw new Error}catch(s){i.stack=s.stack.substring(s.stack.indexOf("\n")+1)}return o.promise=i,o.resolve=function(n){e||t(l(n))},o.fulfill=function(n){e||t(O(n))},o.reject=function(n){e||t(j(n))},o.notify=function(t){e||J(r,function(e,n){W(function(){n(t)})},void 0)},o}function p(t){if("function"!=typeof t)throw new TypeError("resolver must be a function.");var e=f();try{t(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}return e.promise}function h(t){return p(function(e,n){for(var r=0,o=t.length;o>r;r++)l(t[r]).then(e,n)})}function d(t,e,n){void 0===e&&(e=function(t){return j(new Error("Promise does not support operation: "+t))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=te(d.prototype);if(r.promiseDispatch=function(n,o,i){var s;try{s=t[o]?t[o].apply(r,i):e.call(r,o,i)}catch(a){s=j(a)}n&&n(s)},r.inspect=n,n){var o=n();"rejected"===o.state&&(r.exception=o.reason),r.valueOf=c(function(){var t=n();return"pending"===t.state||"rejected"===t.state?r:t.value})}return r}function m(t,e,n,r){return l(t).then(e,n,r)}function v(t){if(y(t)){var e=t.inspect();if("fulfilled"===e.state)return e.value}return t}function y(t){return e(t)&&"function"==typeof t.promiseDispatch&&"function"==typeof t.inspect}function g(t){return e(t)&&"function"==typeof t.then}function _(t){return y(t)&&"pending"===t.inspect().state}function b(t){return!y(t)||"fulfilled"===t.inspect().state}function w(t){return y(t)&&"rejected"===t.inspect().state}function k(){ue||"undefined"==typeof window||window.Touch||!window.console||console.warn("[Q] Unhandled rejection reasons (should be empty):",se),ue=!0}function E(){for(var t=0;t<se.length;t++){var e=se[t];console.warn("Unhandled rejection reason:",e)}}function S(){se.length=0,ae.length=0,ue=!1,ce||(ce=!0,"undefined"!=typeof process&&process.on&&process.on("exit",E))}function x(t,e){ce&&(ae.push(t),e&&"undefined"!=typeof e.stack?se.push(e.stack):se.push("(no stack) "+e),k())}function A(t){if(ce){var e=Q(ae,t);-1!==e&&(ae.splice(e,1),se.splice(e,1))}}function j(t){var e=d({when:function(e){return e&&A(this),e?e(t):this}},function(){return this},function(){return{state:"rejected",reason:t}});return x(e,t),e}function O(t){return d({when:function(){return t},get:function(e){return t[e]},set:function(e,n){t[e]=n},"delete":function(e){delete t[e]},post:function(e,n){return null===e||void 0===e?t.apply(void 0,n):t[e].apply(t,n)},apply:function(e,n){return t.apply(e,n)},keys:function(){return ne(t)}},void 0,function(){return{state:"fulfilled",value:t}})}function I(t){var e=f();return W(function(){try{t.then(e.resolve,e.reject,e.notify)}catch(n){e.reject(n)}}),e.promise}function C(t){return d({isDef:function(){}},function(e,n){return D(t,e,n)},function(){return l(t).inspect()})}function T(t,e,n){return l(t).spread(e,n)}function R(t){return function(){function e(t,e){var s;if(oe){try{s=r[t](e)}catch(a){return j(a)}return s.done?s.value:m(s.value,o,i)}try{s=r[t](e)}catch(a){return n(a)?a.value:j(a)}return m(s,o,i)}var r=t.apply(this,arguments),o=e.bind(e,"next"),i=e.bind(e,"throw");return o()}}function N(t){l.done(l.async(t)())}function P(t){throw new V(t)}function L(t){return function(){return T([this,M(arguments)],function(e,n){return t.apply(e,n)})}}function D(t,e,n){return l(t).dispatch(e,n)}function M(t){return m(t,function(t){var e=0,n=f();return J(t,function(r,o,i){var s;y(o)&&"fulfilled"===(s=o.inspect()).state?t[i]=s.value:(++e,m(o,function(r){t[i]=r,0===--e&&n.resolve(t)},n.reject,function(t){n.notify({index:i,value:t})}))},void 0),0===e&&n.resolve(t),n.promise})}function q(t){return m(t,function(t){return t=Z(t,l),m(M(Z(t,function(t){return m(t,G,G)})),function(){return t})})}function U(t){return l(t).allSettled()}function F(t,e){return l(t).then(void 0,void 0,e)}function B(t,e){return l(t).nodeify(e)}var $=!1;try{throw new Error}catch(H){$=!!H.stack}var z,V,K=u(),G=function(){},W=function(){function t(){for(;e.next;){e=e.next;var n=e.task;e.task=void 0;var o=e.domain;o&&(e.domain=void 0,o.enter());try{n()}catch(s){if(i)throw o&&o.exit(),setTimeout(t,0),o&&o.enter(),s;setTimeout(function(){throw s},0)}o&&o.exit()}r=!1}var e={task:void 0,next:null},n=e,r=!1,o=void 0,i=!1;if(W=function(t){n=n.next={task:t,domain:i&&process.domain,next:null},r||(r=!0,o())},"undefined"!=typeof process&&process.nextTick)i=!0,o=function(){process.nextTick(t)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,t):function(){setImmediate(t)};else if("undefined"!=typeof MessageChannel){var s=new MessageChannel;s.port1.onmessage=function(){o=a,s.port1.onmessage=t,t()};var a=function(){s.port2.postMessage(0)};o=function(){setTimeout(t,0),a()}}else o=function(){setTimeout(t,0)};return W}(),X=Function.call,Y=t(Array.prototype.slice),J=t(Array.prototype.reduce||function(t,e){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){e=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(e=t(e,this[n],n));return e}),Q=t(Array.prototype.indexOf||function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),Z=t(Array.prototype.map||function(t,e){var n=this,r=[];return J(n,function(o,i,s){r.push(t.call(e,i,s,n))},void 0),r}),te=Object.create||function(t){function e(){}return e.prototype=t,new e},ee=t(Object.prototype.hasOwnProperty),ne=Object.keys||function(t){var e=[];for(var n in t)ee(t,n)&&e.push(n);return e},re=t(Object.prototype.toString);V="undefined"!=typeof ReturnValue?ReturnValue:function(t){this.value=t};var oe;try{new Function("(function* (){ yield 1; })"),oe=!0}catch(H){oe=!1}var ie="From previous event:";l.resolve=l,l.nextTick=W,l.longStackSupport=!1,l.defer=f,f.prototype.makeNodeResolver=function(){var t=this;return function(e,n){e?t.reject(e):arguments.length>2?t.resolve(Y(arguments,1)):t.resolve(n)}},l.promise=p,l.passByCopy=function(t){return t},d.prototype.passByCopy=function(){return this},l.join=function(t,e){return l(t).join(e)},d.prototype.join=function(t){return l([this,t]).spread(function(t,e){if(t===e)return t;throw new Error("Can't join: not the same: "+t+" "+e)})},l.race=h,d.prototype.race=function(){return this.then(l.race)},l.makePromise=d,d.prototype.toString=function(){return"[object Promise]"},d.prototype.then=function(t,e,n){function o(e){try{return"function"==typeof t?t(e):e}catch(n){return j(n)}}function i(t){if("function"==typeof e){r(t,a);try{return e(t)}catch(n){return j(n)}}return j(t)}function s(t){return"function"==typeof n?n(t):t}var a=this,u=f(),c=!1;return W(function(){a.promiseDispatch(function(t){c||(c=!0,u.resolve(o(t)))},"when",[function(t){c||(c=!0,u.resolve(i(t)))}])}),a.promiseDispatch(void 0,"when",[void 0,function(t){var e,n=!1;try{e=s(t)}catch(r){if(n=!0,!l.onerror)throw r;l.onerror(r)}n||u.notify(e)}]),u.promise},l.when=m,d.prototype.thenResolve=function(t){return this.then(function(){return t})},l.thenResolve=function(t,e){return l(t).thenResolve(e)},d.prototype.thenReject=function(t){return this.then(function(){throw t})},l.thenReject=function(t,e){return l(t).thenReject(e)},l.nearer=v,l.isPromise=y,l.isPromiseAlike=g,l.isPending=_,d.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=b,d.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=w,d.prototype.isRejected=function(){return"rejected"===this.inspect().state};var se=[],ae=[],ue=!1,ce=!0;l.resetUnhandledRejections=S,l.getUnhandledReasons=function(){return se.slice()},l.stopUnhandledRejectionTracking=function(){S(),"undefined"!=typeof process&&process.on&&process.removeListener("exit",E),ce=!1},S(),l.reject=j,l.fulfill=O,l.master=C,l.spread=T,d.prototype.spread=function(t,e){return this.all().then(function(e){return t.apply(void 0,e)},e)},l.async=R,l.spawn=N,l["return"]=P,l.promised=L,l.dispatch=D,d.prototype.dispatch=function(t,e){var n=this,r=f();return W(function(){n.promiseDispatch(r.resolve,t,e)}),r.promise},l.get=function(t,e){return l(t).dispatch("get",[e])},d.prototype.get=function(t){return this.dispatch("get",[t])},l.set=function(t,e,n){return l(t).dispatch("set",[e,n])},d.prototype.set=function(t,e){return this.dispatch("set",[t,e])},l.del=l["delete"]=function(t,e){return l(t).dispatch("delete",[e])},d.prototype.del=d.prototype["delete"]=function(t){return this.dispatch("delete",[t])},l.mapply=l.post=function(t,e,n){return l(t).dispatch("post",[e,n])},d.prototype.mapply=d.prototype.post=function(t,e){return this.dispatch("post",[t,e])},l.send=l.mcall=l.invoke=function(t,e){return l(t).dispatch("post",[e,Y(arguments,2)])},d.prototype.send=d.prototype.mcall=d.prototype.invoke=function(t){return this.dispatch("post",[t,Y(arguments,1)])},l.fapply=function(t,e){return l(t).dispatch("apply",[void 0,e])},d.prototype.fapply=function(t){return this.dispatch("apply",[void 0,t])},l["try"]=l.fcall=function(t){return l(t).dispatch("apply",[void 0,Y(arguments,1)])},d.prototype.fcall=function(){return this.dispatch("apply",[void 0,Y(arguments)])},l.fbind=function(t){var e=l(t),n=Y(arguments,1);return function(){return e.dispatch("apply",[this,n.concat(Y(arguments))])}},d.prototype.fbind=function(){var t=this,e=Y(arguments);return function(){return t.dispatch("apply",[this,e.concat(Y(arguments))])}},l.keys=function(t){return l(t).dispatch("keys",[])},d.prototype.keys=function(){return this.dispatch("keys",[])},l.all=M,d.prototype.all=function(){return M(this)},l.allResolved=c(q,"allResolved","allSettled"),d.prototype.allResolved=function(){return q(this)},l.allSettled=U,d.prototype.allSettled=function(){return this.then(function(t){return M(Z(t,function(t){function e(){return t.inspect()}return t=l(t),t.then(e,e)}))})},l.fail=l["catch"]=function(t,e){return l(t).then(void 0,e)},d.prototype.fail=d.prototype["catch"]=function(t){return this.then(void 0,t)},l.progress=F,d.prototype.progress=function(t){return this.then(void 0,void 0,t)},l.fin=l["finally"]=function(t,e){return l(t)["finally"](e)},d.prototype.fin=d.prototype["finally"]=function(t){return t=l(t),this.then(function(e){return t.fcall().then(function(){return e})},function(e){return t.fcall().then(function(){throw e})})},l.done=function(t,e,n,r){return l(t).done(e,n,r)},d.prototype.done=function(t,e,n){var o=function(t){W(function(){if(r(t,i),!l.onerror)throw t;l.onerror(t)})},i=t||e||n?this.then(t,e,n):this;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),i.then(void 0,o)},l.timeout=function(t,e,n){return l(t).timeout(e,n)},d.prototype.timeout=function(t,e){var n=f(),r=setTimeout(function(){n.reject(new Error(e||"Timed out after "+t+" ms"))},t);return this.then(function(t){clearTimeout(r),n.resolve(t)},function(t){clearTimeout(r),n.reject(t)},n.notify),n.promise},l.delay=function(t,e){return void 0===e&&(e=t,t=void 0),l(t).delay(e)},d.prototype.delay=function(t){return this.then(function(e){var n=f();return setTimeout(function(){n.resolve(e)},t),n.promise})},l.nfapply=function(t,e){return l(t).nfapply(e)},d.prototype.nfapply=function(t){var e=f(),n=Y(t);return n.push(e.makeNodeResolver()),this.fapply(n).fail(e.reject),e.promise},l.nfcall=function(t){var e=Y(arguments,1);return l(t).nfapply(e)},d.prototype.nfcall=function(){var t=Y(arguments),e=f();return t.push(e.makeNodeResolver()),this.fapply(t).fail(e.reject),e.promise},l.nfbind=l.denodeify=function(t){var e=Y(arguments,1);return function(){var n=e.concat(Y(arguments)),r=f();return n.push(r.makeNodeResolver()),l(t).fapply(n).fail(r.reject),r.promise}},d.prototype.nfbind=d.prototype.denodeify=function(){var t=Y(arguments);return t.unshift(this),l.denodeify.apply(void 0,t)},l.nbind=function(t,e){var n=Y(arguments,2);return function(){function r(){return t.apply(e,arguments)}var o=n.concat(Y(arguments)),i=f();return o.push(i.makeNodeResolver()),l(r).fapply(o).fail(i.reject),i.promise}},d.prototype.nbind=function(){var t=Y(arguments,0);return t.unshift(this),l.nbind.apply(void 0,t)},l.nmapply=l.npost=function(t,e,n){return l(t).npost(e,n)},d.prototype.nmapply=d.prototype.npost=function(t,e){var n=Y(e||[]),r=f();return n.push(r.makeNodeResolver()),this.dispatch("post",[t,n]).fail(r.reject),r.promise},l.nsend=l.nmcall=l.ninvoke=function(t,e){var n=Y(arguments,2),r=f();return n.push(r.makeNodeResolver()),l(t).dispatch("post",[e,n]).fail(r.reject),r.promise},d.prototype.nsend=d.prototype.nmcall=d.prototype.ninvoke=function(t){var e=Y(arguments,1),n=f();return e.push(n.makeNodeResolver()),this.dispatch("post",[t,e]).fail(n.reject),n.promise},l.nodeify=B,d.prototype.nodeify=function(t){return t?(this.then(function(e){W(function(){t(null,e)})},function(e){W(function(){t(e)})}),void 0):this};var le=u();return l}),define("util/resolver",["lodash","Q"],function(t,e){function n(e,r,o){t.bindAll(this),this._deferred=n.Q.defer(),this._fn=e||function(){},this._context=r,this._keys=o,this.cb=this._lift,this.promise=this._deferred.promise}return n.Q=e,n.prototype._lift=function(e){if(e)return this._conclude("reject",e,arguments);
var n=t.toArray(arguments).slice(1);if(1===n.length&&this._keys)throw new Error("when a single arg is returned, no keys can be passed");if(1===n.length)return this._conclude("resolve",n[0],arguments);var r,o={};t.map(this._keys,function(t){return"..."===t.slice(-3)?(r=t.slice(0,t.length-3),o[r]=n,void 0):(o[t]=n.shift(),void 0)}),this._conclude("resolve",o,arguments)},n.prototype._conclude=function(t,e,n){this._deferred[t](e),this._fn.apply(this._context,n)},n}),define("sharedConfig",[],function(){var t={};return t.version="1.12.9",t.serverUrl="https://goinstant.net",t.authServerUrl="https://auth.goinstant.net",t.domain="goinstant.net",t.httpsOnly="true"==="True".toLowerCase(),t.componentsUrl="https://cdn.goinstant.net/components/",t.isBarista=window?!!window.isBarista:!1,t.isBarista&&(t.httpsOnly=!1),t}),define("util/guard",["lodash","global/window"],function(t,e){var n={};return n.one=function(n,r){if(!n)throw new Error("Attempted to guard a function that did not exist.");if(!t.isFunction(n))throw new Error("Attempted to guard a property that is not a function");if(!r)throw new Error("Context was not passed to guard");return function(){try{n.apply(r,arguments)}catch(t){e.setTimeout(function(){throw t},0)}}},n.all=function(e,r){t.each(r,function(t){e[t]=n.one(e[t],e)})},n}),function(){function t(e,n,r){var o=t.resolve(e);if(null==o){r=r||e,n=n||"root";var i=new Error('Failed to require "'+r+'" from "'+n+'"');throw i.path=r,i.parent=n,i.require=!0,i}var s=t.modules[o];return s.exports||(s.exports={},s.client=s.component=!0,s.call(this,s.exports,t.relative(o),s)),s.exports}if(t.modules={},t.aliases={},t.resolve=function(e){"/"===e.charAt(0)&&(e=e.slice(1));for(var n=e+"/index.js",r=[e,e+".js",e+".json",e+"/index.js",e+"/index.json"],o=0;o<r.length;o++){var e=r[o];if(t.modules.hasOwnProperty(e))return e}return t.aliases.hasOwnProperty(n)?t.aliases[n]:void 0},t.normalize=function(t,e){var n=[];if("."!=e.charAt(0))return e;t=t.split("/"),e=e.split("/");for(var r=0;r<e.length;++r)".."==e[r]?t.pop():"."!=e[r]&&""!=e[r]&&n.push(e[r]);return t.concat(n).join("/")},t.register=function(e,n){t.modules[e]=n},t.alias=function(e,n){if(!t.modules.hasOwnProperty(e))throw new Error('Failed to alias "'+e+'", it does not exist');t.aliases[n]=e},t.relative=function(e){function n(t,e){for(var n=t.length;n--;)if(t[n]===e)return n;return-1}function r(n){var o=r.resolve(n);return t(o,e,n)}var o=t.normalize(e,"..");return r.resolve=function(r){var i=r.charAt(0);if("/"==i)return r.slice(1);if("."==i)return t.normalize(o,r);var s=e.split("/"),a=n(s,"deps")+1;return a||(a=0),r=s.slice(0,a+1).join("/")+"/deps/"+r},r.exists=function(e){return t.modules.hasOwnProperty(r.resolve(e))},r},t.register("component-emitter/index.js",function(t,e,n){function r(t){return t?o(t):void 0}function o(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}n.exports=r,r.prototype.on=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks[t]=this._callbacks[t]||[]).push(e),this},r.prototype.once=function(t,e){function n(){r.off(t,n),e.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},e._off=n,this.on(t,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[t];if(!n)return this;if(1==arguments.length)return delete this._callbacks[t],this;var r=n.indexOf(e._off||e);return~r&&n.splice(r,1),this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),n=this._callbacks[t];if(n){n=n.slice(0);for(var r=0,o=n.length;o>r;++r)n[r].apply(this,e)}return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks[t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}}),t.register("component-indexof/index.js",function(t,e,n){var r=[].indexOf;n.exports=function(t,e){if(r)return t.indexOf(e);for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}}),t.register("LearnBoost-engine.io-protocol/lib/index.js",function(t,e){var n=e("./keys");t.protocol=2;var r=t.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},o=n(r),i={type:"error",data:"parser error"};t.encodePacket=function(t){var e=r[t.type];return void 0!==t.data&&(e+=String(t.data)),""+e},t.decodePacket=function(t){var e=t.charAt(0);return Number(e)==e&&o[e]?t.length>1?{type:o[e],data:t.substring(1)}:{type:o[e]}:i},t.encodePayload=function(e){if(!e.length)return"0:";for(var n,r="",o=0,i=e.length;i>o;o++)n=t.encodePacket(e[o]),r+=n.length+":"+n;return r},t.decodePayload=function(e,n){var r;if(""==e)return n(i,0,1);for(var o,s,a="",u=0,c=e.length;c>u;u++){var l=e.charAt(u);if(":"!=l)a+=l;else{if(""==a||a!=(o=Number(a)))return n(i,0,1);if(s=e.substr(u+1,o),a!=s.length)return n(i,0,1);if(s.length){if(r=t.decodePacket(s),i.type==r.type&&i.data==r.data)return n(i,0,1);var f=n(r,u+o,c);if(!1===f)return}u+=o,a=""}}return""!=a?n(i,0,1):void 0}}),t.register("LearnBoost-engine.io-protocol/lib/keys.js",function(t,e,n){n.exports=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e}}),t.register("visionmedia-debug/index.js",function(t,e,n){n.exports="undefined"==typeof window?e("./lib/debug"):e("./debug")}),t.register("visionmedia-debug/debug.js",function(t,e,n){function r(t){return r.enabled(t)?function(e){e=o(e);var n=new Date,i=n-(r[t]||n);r[t]=n,e=t+" "+e+" +"+r.humanize(i),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function o(t){return t instanceof Error?t.stack||t.message:t}n.exports=r,r.names=[],r.skips=[],r.enable=function(t){try{localStorage.debug=t}catch(e){}for(var n=(t||"").split(/[\s,]+/),o=n.length,i=0;o>i;i++)t=n[i].replace("*",".*?"),"-"===t[0]?r.skips.push(new RegExp("^"+t.substr(1)+"$")):r.names.push(new RegExp("^"+t+"$"))},r.disable=function(){r.enable("")},r.humanize=function(t){var e=1e3,n=6e4,r=60*n;return t>=r?(t/r).toFixed(1)+"h":t>=n?(t/n).toFixed(1)+"m":t>=e?(0|t/e)+"s":t+"ms"},r.enabled=function(t){for(var e=0,n=r.skips.length;n>e;e++)if(r.skips[e].test(t))return!1;for(var e=0,n=r.names.length;n>e;e++)if(r.names[e].test(t))return!0;return!1},window.localStorage&&r.enable(localStorage.debug)}),t.register("engine.io/lib/index.js",function(t,e,n){n.exports=e("./socket"),n.exports.parser=e("engine.io-parser")}),t.register("engine.io/lib/socket.js",function(t,e,n){function r(t,e){if(!(this instanceof r))return new r(t,e);if(e=e||{},"object"==typeof t&&(e=t,t=null),t&&(t=i.parseUri(t),e.host=t.host,e.secure="https"==t.protocol||"wss"==t.protocol,e.port=t.port,t.query&&(e.query=t.query)),this.secure=null!=e.secure?e.secure:f.location&&"https:"==location.protocol,e.host){var n=e.host.split(":");e.hostname=n.shift(),n.length&&(e.port=n.pop())}this.hostname=e.hostname||(f.location?location.hostname:"localhost"),this.port=e.port||(f.location&&location.port?location.port:this.secure?443:80),this.query=e.query||{},"string"==typeof this.query&&(this.query=i.qsParse(this.query)),this.upgrade=!1!==e.upgrade,this.path=(e.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!e.forceJSONP,this.timestampParam=e.timestampParam||"t",this.timestampRequests=!!e.timestampRequests,this.flashPath=e.flashPath||"",this.transports=e.transports||["polling","websocket","flashsocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=e.policyPort||843,this.open(),r.sockets.push(this),r.sockets.evs.emit("add",this)}function o(t){var e={};for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}var i=e("./util"),s=e("./transports"),a=e("./emitter"),u=e("debug")("engine-client:socket"),c=e("indexof"),l=e("engine.io-parser");n.exports=r;var f=i.global();a(r.prototype),r.protocol=l.protocol,r.sockets=[],r.sockets.evs=new a,r.Socket=r,r.Transport=e("./transport"),r.Emitter=e("./emitter"),r.transports=e("./transports"),r.util=e("./util"),r.parser=e("engine.io-parser"),r.prototype.createTransport=function(t){u('creating transport "%s"',t);var e=o(this.query);e.EIO=l.protocol,e.transport=t,this.id&&(e.sid=this.id);var n=new s[t]({hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:e,forceJSONP:this.forceJSONP,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,flashPath:this.flashPath,policyPort:this.policyPort});return n},r.prototype.open=function(){this.readyState="opening";var t=this.createTransport(this.transports[0]);t.open(),this.setTransport(t)},r.prototype.setTransport=function(t){var e=this;this.transport&&(u("clearing existing transport"),this.transport.removeAllListeners()),this.transport=t,t.on("drain",function(){e.onDrain()}).on("packet",function(t){e.onPacket(t)}).on("error",function(t){e.onError(t)}).on("close",function(){e.onClose("transport close")})},r.prototype.probe=function(t){function e(e){if(!r){r=!0;var i=new Error("probe error: "+e);i.transport=n.name,n.close(),n=null,u('probe transport "%s" failed because of error: %s',t,e),o.emit("error",i)}}u('probing transport "%s"',t);var n=this.createTransport(t,{probe:1}),r=!1,o=this;n.once("open",function(){r||(u('probe transport "%s" opened',t),n.send([{type:"ping",data:"probe"}]),n.once("packet",function(i){if(!r)if("pong"==i.type&&"probe"==i.data)u('probe transport "%s" pong',t),o.upgrading=!0,o.emit("upgrading",n),u('pausing current transport "%s"',o.transport.name),o.transport.pause(function(){r||"closed"!=o.readyState&&"closing"!=o.readyState&&(u("changing transport and sending upgrade packet"),n.removeListener("error",e),o.emit("upgrade",n),o.setTransport(n),n.send([{type:"upgrade"}]),n=null,o.upgrading=!1,o.flush())});else{u('probe transport "%s" failed',t);var s=new Error("probe error");s.transport=n.name,o.emit("error",s)}}))}),n.once("error",e),n.open(),this.once("close",function(){n&&(u("socket closed prematurely - aborting probe"),r=!0,n.close(),n=null)}),this.once("upgrading",function(t){n&&t.name!=n.name&&(u('"%s" works - aborting "%s"',t.name,n.name),n.close(),n=null)})},r.prototype.onOpen=function(){if(u("socket open"),this.readyState="open",this.emit("open"),this.onopen&&this.onopen.call(this),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){u("starting upgrade probes");for(var t=0,e=this.upgrades.length;e>t;t++)this.probe(this.upgrades[t])}},r.prototype.onPacket=function(t){if("opening"==this.readyState||"open"==this.readyState)switch(u('socket receive: type "%s", data "%s"',t.type,t.data),this.emit("packet",t),this.emit("heartbeat"),t.type){case"open":this.onHandshake(i.parseJSON(t.data));break;case"pong":this.setPing();break;case"error":var e=new Error("server error");e.code=t.data,this.emit("error",e);break;case"message":this.emit("data",t.data),this.emit("message",t.data);var n={data:t.data};n.toString=function(){return t.data},this.onmessage&&this.onmessage.call(this,n)}else u('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(t){this.emit("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.onOpen(),this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat)},r.prototype.onHeartbeat=function(t){clearTimeout(this.pingTimeoutTimer);var e=this;e.pingTimeoutTimer=setTimeout(function(){"closed"!=e.readyState&&e.onClose("ping timeout")},t||e.pingInterval+e.pingTimeout)},r.prototype.setPing=function(){var t=this;clearTimeout(t.pingIntervalTimer),t.pingIntervalTimer=setTimeout(function(){u("writing ping packet - expecting pong within %sms",t.pingTimeout),t.ping(),t.onHeartbeat(t.pingTimeout)},t.pingInterval)},r.prototype.ping=function(){this.sendPacket("ping")},r.prototype.onDrain=function(){this.callbacks(),this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.callbacks=function(){for(var t=0;t<this.prevBufferLen;t++)this.callbackBuffer[t]&&this.callbackBuffer[t]()},r.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(u("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(t,e){return this.sendPacket("message",t,e),this},r.prototype.sendPacket=function(t,e,n){var r={type:t,data:e};this.emit("packetCreate",r),this.writeBuffer.push(r),this.callbackBuffer.push(n),this.flush()},r.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.onClose("forced close"),u("socket closing - telling transport to close"),this.transport.close(),this.transport.removeAllListeners()),this},r.prototype.onError=function(t){u("socket error %j",t),this.emit("error",t),this.onClose("transport error",t)},r.prototype.onClose=function(t,e){if("opening"==this.readyState||"open"==this.readyState){u('socket close with reason: "%s"',t);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){n.writeBuffer=[],n.callbackBuffer=[],n.prevBufferLen=0},0);var r=this.readyState;this.readyState="closed","open"==r&&this.emit("close",t,e),this.onclose&&this.onclose.call(this),this.id=null}},r.prototype.filterUpgrades=function(t){for(var e=[],n=0,r=t.length;r>n;n++)~c(this.transports,t[n])&&e.push(t[n]);return e}}),t.register("engine.io/lib/transport.js",function(t,e,n){function r(t){this.path=t.path,this.hostname=t.hostname,this.port=t.port,this.secure=t.secure,this.query=t.query,this.timestampParam=t.timestampParam,this.timestampRequests=t.timestampRequests,this.readyState=""}var o=(e("./util"),e("engine.io-parser")),i=e("./emitter");n.exports=r,i(r.prototype),r.prototype.onError=function(t,e){var n=new Error(t);return n.type="TransportError",n.description=e,this.emit("error",n),this},r.prototype.open=function(){return("closed"==this.readyState||""==this.readyState)&&(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return("opening"==this.readyState||"open"==this.readyState)&&(this.doClose(),this.onClose()),this},r.prototype.send=function(t){if("open"!=this.readyState)throw new Error("Transport not open");this.write(t)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(t){this.onPacket(o.decodePacket(t))},r.prototype.onPacket=function(t){this.emit("packet",t)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}}),t.register("engine.io/lib/emitter.js",function(t,e,n){var r=e("emitter");n.exports=r,r.prototype.addEventListener=r.prototype.on,r.prototype.removeEventListener=r.prototype.off,r.prototype.removeListener=r.prototype.off}),t.register("engine.io/lib/util.js",function(t,e){var n=!1;t.global=function(){return"undefined"!=typeof window?window:global},t.inherits=function(t,e){function n(){}n.prototype=e.prototype,t.prototype=new n},t.keys=Object.keys||function(t){var e=[],n=Object.prototype.hasOwnProperty;for(var r in t)n.call(t,r)&&e.push(r);return e},t.on=function(t,e,n,r){t.attachEvent?t.attachEvent("on"+e,n):t.addEventListener&&t.addEventListener(e,n,r)},t.load=function(e){var r=t.global();return r.document&&"complete"===document.readyState||n?e():(t.on(r,"load",e,!1),void 0)},"undefined"!=typeof window&&t.load(function(){n=!0}),t.defer=function(e){return t.ua.webkit&&"undefined"==typeof importScripts?(t.load(function(){setTimeout(e,100)}),void 0):e()};var r=/^[\],:{}\s]*$/,o=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,i=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,s=/(?:^|:|,)(?:\s*\[)+/g,a=/^\s+/,u=/\s+$/;t.parseJSON=function(e){var n=t.global();return"string"==typeof e&&e?(e=e.replace(a,"").replace(u,""),n.JSON&&JSON.parse?JSON.parse(e):r.test(e.replace(o,"@").replace(i,"]").replace(s,""))?new Function("return "+e)():void 0):null},t.ua={},t.ua.hasCORS="undefined"!=typeof XMLHttpRequest&&function(){var t;try{t=new XMLHttpRequest}catch(e){return!1}return void 0!=t.withCredentials}(),t.ua.webkit="undefined"!=typeof navigator&&/webkit/i.test(navigator.userAgent),t.ua.gecko="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent),t.ua.android="undefined"!=typeof navigator&&/android/i.test(navigator.userAgent),t.ua.ios="undefined"!=typeof navigator&&/^(iPad|iPhone|iPod)$/.test(navigator.platform),t.ua.ios6=t.ua.ios&&/OS 6_/.test(navigator.userAgent),t.request=function(n){try{var r=e("xmlhttprequest").XMLHttpRequest;return new r}catch(o){}if(n&&"undefined"!=typeof XDomainRequest&&!t.ua.hasCORS)return new XDomainRequest;try{if("undefined"!=typeof XMLHttpRequest&&(!n||t.ua.hasCORS))return new XMLHttpRequest}catch(o){}if(!n)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(o){}};var c=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,l=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.parseUri=function(t){for(var e=c.exec(t||""),n={},r=14;r--;)n[l[r]]=e[r]||"";return n},t.qs=function(t){var e="";for(var n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e},t.qsParse=function(t){for(var e={},n=t.split("&"),r=0,o=n.length;o>r;r++){var i=n[r].split("=");e[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return e}}),t.register("engine.io/lib/transports/index.js",function(t,e){function n(t){var e,n=!1,i=!1;if(u.location){var s="https:"==location.protocol,c=location.port;Number(c)!==c&&(c=s?443:80),n=t.hostname!=location.hostname||c!=t.port,i=t.secure!=s}return e=a.request(n),i&&u.XDomainRequest&&e instanceof u.XDomainRequest?new o(t):e&&!t.forceJSONP?new r(t):new o(t)}var r=e("./polling-xhr"),o=e("./polling-jsonp"),i=e("./websocket"),s=e("./flashsocket"),a=e("../util");t.polling=n,t.websocket=i,t.flashsocket=s;var u=a.global()}),t.register("engine.io/lib/transports/polling.js",function(t,e,n){function r(t){o.call(this,t)}var o=e("../transport"),i=e("../util"),s=e("engine.io-parser"),a=e("debug")("engine.io-client:polling");n.exports=r;var u=i.global();i.inherits(r,o),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(t){function e(){a("paused"),n.readyState="paused",t()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(a("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){a("pre-pause polling complete"),--r||e()})),this.writable||(a("we are currently writing - waiting to pause"),r++,this.once("drain",function(){a("pre-pause writing complete"),--r||e()}))}else e()},r.prototype.poll=function(){a("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(t){var e=this;a("polling got data %s",t),s.decodePayload(t,function(t){return"opening"==e.readyState&&e.onOpen(),"close"==t.type?(e.onClose(),!1):(e.onPacket(t),void 0)}),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():a('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){a("sending close packet"),this.send([{type:"close"}])},r.prototype.write=function(t){var e=this;this.writable=!1,this.doWrite(s.encodePayload(t),function(){e.writable=!0,e.emit("drain")})},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"https":"http",n="";return(u.ActiveXObject||i.ua.android||i.ua.ios6||this.timestampRequests)&&(t[this.timestampParam]=+new Date),t=i.qs(t),this.port&&("https"==e&&443!=this.port||"http"==e&&80!=this.port)&&(n=":"+this.port),t.length&&(t="?"+t),e+"://"+this.hostname+n+this.path+t}}),t.register("engine.io/lib/transports/polling-xhr.js",function(t,e,n){function r(){}function o(t){if(s.call(this,t),l.location){var e="https:"==location.protocol,n=location.port;Number(n)!==n&&(n=e?443:80),this.xd=t.hostname!=l.location.hostname||n!=t.port}}function i(t){this.method=t.method||"GET",this.uri=t.uri,this.xd=!!t.xd,this.async=!1!==t.async,this.data=void 0!=t.data?t.data:null,this.create()}var s=e("./polling"),a=e("../util"),u=e("../emitter"),c=e("debug")("engine.io-client:polling-xhr");n.exports=o,n.exports.Request=i;var l=a.global(),f=l[["Active"].concat("Object").join("X")];a.inherits(o,s),o.prototype.doOpen=function(){var t=this;a.defer(function(){s.prototype.doOpen.call(t)})},o.prototype.request=function(t){return t=t||{},t.uri=this.uri(),t.xd=this.xd,new i(t)},o.prototype.doWrite=function(t,e){var n=this.request({method:"POST",data:t}),r=this;n.on("success",e),n.on("error",function(t){r.onError("xhr post error",t)}),this.sendXhr=n},o.prototype.doPoll=function(){c("xhr poll");var t=this.request(),e=this;t.on("data",function(t){e.onData(t)}),t.on("error",function(t){e.onError("xhr poll error",t)}),this.pollXhr=t},u(i.prototype),i.prototype.create=function(){var t=this.xhr=a.request(this.xd),e=this;if(t.open(this.method,this.uri,this.async),"POST"==this.method)try{t.setRequestHeader?t.setRequestHeader("Content-type","text/plain;charset=UTF-8"):t.contentType="text/plain"}catch(n){}this.xd&&l.XDomainRequest&&t instanceof XDomainRequest?(t.onerror=function(t){e.onError(t)},t.onload=function(){e.onData(t.responseText)},t.onprogress=r):("withCredentials"in t&&(t.withCredentials=!0),t.onreadystatechange=function(){var n;try{if(4!=t.readyState)return;200==t.status||1223==t.status?n=t.responseText:e.onError(t.status)}catch(r){e.onError(r)}void 0!==n&&e.onData(n)}),c("sending xhr with url %s | data %s",this.uri,this.data);try{t.send(this.data)}catch(n){return setTimeout(function(){e.onError(n)},0),void 0}f&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(t){this.emit("data",t),this.onSuccess()},i.prototype.onError=function(t){this.emit("error",t),this.cleanup()},i.prototype.cleanup=function(){if("undefined"!=typeof this.xhr){this.xhr.onreadystatechange=r,this.xhr.onload=this.xhr.onerror=r;try{this.xhr.abort()}catch(t){}f&&delete i.requests[this.index],this.xhr=null}},i.prototype.abort=function(){this.cleanup()},f&&(i.requestsCount=0,i.requests={},l.attachEvent("onunload",function(){for(var t in i.requests)i.requests.hasOwnProperty(t)&&i.requests[t].abort()}))}),t.register("engine.io/lib/transports/polling-jsonp.js",function(t,e,n){function r(t){o.call(this,t),s||(a.___eio||(a.___eio=[]),s=a.___eio),this.index=s.length;var e=this;s.push(function(t){e.onData(t)}),this.query.j=this.index}var o=e("./polling"),i=e("../util");n.exports=r;var s,a=i.global(),u=/\n/g;i.inherits(r,o),r.prototype.doOpen=function(){var t=this;i.defer(function(){o.prototype.doOpen.call(t)})},r.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null),o.prototype.doClose.call(this)},r.prototype.doPoll=function(){var t=this,e=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),e.async=!0,e.src=this.uri(),e.onerror=function(e){t.onError("jsonp poll error",e)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n),this.script=e,i.ua.gecko&&setTimeout(function(){var t=document.createElement("iframe");document.body.appendChild(t),document.body.removeChild(t)},100)},r.prototype.doWrite=function(t,e){function n(){r(),e()}function r(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(t){o.onError("jsonp polling iframe removal error",t)}try{var e='<iframe src="javascript:0" name="'+o.iframeId+'">';i=document.createElement(e)}catch(t){i=document.createElement("iframe"),i.name=o.iframeId,i.src="javascript:0"}i.id=o.iframeId,o.form.appendChild(i),o.iframe=i}var o=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),c=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=c,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),r(),this.area.value=t.replace(u,"\\n");try{this.form.submit()}catch(l){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==o.iframe.readyState&&n()}:this.iframe.onload=n}}),t.register("engine.io/lib/transports/websocket.js",function(t,e,n){function r(t){i.call(this,t)}function o(){return"undefined"==typeof window?e("ws"):u.WebSocket||u.MozWebSocket}var i=e("../transport"),s=e("engine.io-parser"),a=e("../util");e("debug")("engine.io-client:websocket"),n.exports=r;var u=a.global();a.inherits(r,i),r.prototype.name="websocket",r.prototype.doOpen=function(){if(this.check()){var t=this;this.socket=new(o())(this.uri()),this.socket.onopen=function(){t.onOpen()},this.socket.onclose=function(){t.onClose()},this.socket.onmessage=function(e){t.onData(e.data)},this.socket.onerror=function(e){t.onError("websocket error",e)}}},r.prototype.write=function(t){function e(){n.writable=!0,n.emit("drain")}var n=this;this.writable=!1;for(var r=0,o=t.length;o>r;r++)this.socket.send(s.encodePacket(t[r]));"bufferedAmount"in this.socket?this.bufferedAmountId=setInterval(function(){0==n.socket.bufferedAmount&&(clearInterval(n.bufferedAmountId),e())},50):setTimeout(e,0)},r.prototype.onClose=function(){clearInterval(this.bufferedAmountId),i.prototype.onClose.call(this)},r.prototype.doClose=function(){"undefined"!=typeof this.socket&&this.socket.close()},r.prototype.uri=function(){var t=this.query||{},e=this.secure?"wss":"ws",n="";return this.port&&("wss"==e&&443!=this.port||"ws"==e&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(t[this.timestampParam]=+new Date),t=a.qs(t),t.length&&(t="?"+t),e+"://"+this.hostname+n+this.path+t},r.prototype.check=function(){var t=o();return!(!t||"__initialize"in t&&this.name===r.prototype.name)}}),t.register("engine.io/lib/transports/flashsocket.js",function(t,e,n){function r(t){s.call(this,t),this.flashPath=t.flashPath,this.policyPort=t.policyPort}function o(t,e){if(f[t])return e();var n=document.createElement("script"),r=!1;u('loading "%s"',t),n.onload=n.onreadystatechange=function(){if(!r&&!f[t]){var o=n.readyState;o&&"loaded"!=o&&"complete"!=o||(u('loaded "%s"',t),n.onload=n.onreadystatechange=null,r=!0,f[t]=!0,e())}},n.async=1,n.src=t;var o=document.getElementsByTagName("head")[0];o.insertBefore(n,o.firstChild)}function i(t,e){function n(r){return t[r]?(o(t[r],function(){n(++r)}),void 0):e()}n(0)}var s=e("./websocket"),a=e("../util"),u=e("debug")("engine.io-client:flashsocket");n.exports=r;var c=a.global(),l=c[["Active"].concat("Object").join("X")];a.inherits(r,s),r.prototype.name="flashsocket",r.prototype.doOpen=function(){function t(t){return function(){var e=Array.prototype.join.call(arguments," ");u("[websocketjs %s] %s",t,e)}}if(this.check()){WEB_SOCKET_LOGGER={log:t("debug"),error:t("error")},WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR=!0,WEB_SOCKET_DISABLE_AUTO_INITIALIZATION=!0,"undefined"==typeof WEB_SOCKET_SWF_LOCATION&&(WEB_SOCKET_SWF_LOCATION=this.flashPath+"WebSocketMainInsecure.swf");var e=[this.flashPath+"web_socket.js"];"undefined"==typeof swfobject&&e.unshift(this.flashPath+"swfobject.js");var n=this;i(e,function(){n.ready(function(){WebSocket.__addTask(function(){s.prototype.doOpen.call(n)})})})}},r.prototype.doClose=function(){if(this.socket){var t=this;WebSocket.__addTask(function(){s.prototype.doClose.call(t)})}},r.prototype.write=function(){var t=this,e=arguments;WebSocket.__addTask(function(){s.prototype.write.apply(t,e)})},r.prototype.ready=function(t){function e(){r.loaded||(843!=n.policyPort&&WebSocket.loadFlashPolicyFile("xmlsocket://"+n.host+":"+n.policyPort),WebSocket.__initialize(),r.loaded=!0),t.call(n)}if("undefined"!=typeof WebSocket&&"__initialize"in WebSocket&&swfobject&&!(swfobject.getFlashPlayerVersion().major<10)){var n=this;return document.body?e():(a.load(e),void 0)}},r.prototype.check=function(){if("undefined"==typeof window)return!1;if("undefined"!=typeof WebSocket&&!("__initialize"in WebSocket))return!1;if(l){var t=null;try{t=new l("ShockwaveFlash.ShockwaveFlash")}catch(e){}if(t)return!0}else for(var n=0,r=navigator.plugins.length;r>n;n++)for(var o=0,i=navigator.plugins[n].length;i>o;o++)if("Shockwave Flash"==navigator.plugins[n][o].description)return!0;return!1};var f={}}),t.alias("component-emitter/index.js","engine.io/deps/emitter/index.js"),t.alias("component-emitter/index.js","emitter/index.js"),t.alias("component-indexof/index.js","engine.io/deps/indexof/index.js"),t.alias("component-indexof/index.js","indexof/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","engine.io/deps/engine.io-parser/lib/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/keys.js","engine.io/deps/engine.io-parser/lib/keys.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","engine.io/deps/engine.io-parser/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","engine.io-parser/index.js"),t.alias("LearnBoost-engine.io-protocol/lib/index.js","LearnBoost-engine.io-protocol/index.js"),t.alias("visionmedia-debug/index.js","engine.io/deps/debug/index.js"),t.alias("visionmedia-debug/debug.js","engine.io/deps/debug/debug.js"),t.alias("visionmedia-debug/index.js","debug/index.js"),t.alias("engine.io/lib/index.js","engine.io/index.js"),"object"==typeof exports)module.exports=t("engine.io");else if("function"==typeof define&&define.amd){var e=function(){return t("engine.io")};define("eio",e)}else this.eio=t("engine.io")}(),define("util/backoff",["eventemitter2","lodash"],function(t,e){function n(e){this._failAfter=e&&e.failAfter||10,this._startDelay=e&&e.startDelay||100,this._maxDelay=e&&e.maxDelay||1e4,this._fibo1=1,this._fibo2=1,this._currentAttempt=1,this._timeOut=null,this._lastDelay=this._startDelay,this._emitter=new t}function r(t){if(!e.contains(o,t))throw new Error("Unknown event type: "+t)}var o=["start","finish","fail"];return n.prototype.on=function(t,e){r(t),this._emitter.on(t,e)},n.prototype.off=function(t,e){r(t),this._emitter.off(t,e)},n.prototype.start=function(){if(this._currentAttempt>=this._failAfter)return this.reset(),this._emitter.emit("fail"),void 0;var t=this._fibonacci(),n=this._currentAttempt;this._currentAttempt++;var r=Math.min(this._startDelay*t,this._maxDelay);this._lastDelay=r,this._emitter.emit("start",n,r,this),this._timeOut=setTimeout(e.bind(function(){this._emitter.emit("finish",n,r,this)},this),r)},n.prototype.reset=function(){this._currentAttempt=1,this._fibo1=1,this._fibo2=1,this._timeOut&&(clearTimeout(this._timeOut),this._timeOut=null)},n.prototype._fibonacci=function(){if(this._currentAttempt<3)return 1;var t=this._fibo1+this._fibo2;return this._fibo1=this._fibo2,this._fibo2=t,t},n}),define("util/logging",["lodash"],function(t){function e(e){this.moduleName=e,t.bind(this.log,this),t.each(i,function(e){var n=r[e];this[e]=t.bind(this.log,this,n)},this)}var n={},r={silly:0,debug:1,verbose:2,info:3,warn:4,error:5},o=t.invert(r),i=t.keys(r);return n.loggers={},n.raw=function(){},n.Logger=e,e.prototype.log=function(e){var r=Array.prototype.slice.call(arguments,1),i=r[r.length-1],s=t.isFunction(i)?r.pop():null;i=r[r.length-1];var a=t.isObject(i)&&!t.isArray(i)?r.pop():{},u=r.shift();n.raw(o[e]+": "+this.moduleName+": "+u,r,a),s&&s()},n.logger=function(t){return n.loggers[t]||(n.loggers[t]=new e(t)),n.loggers[t]},n.get=n.logger,n}),define("global/navigator",["global/window"],function(t){return t.navigator}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);
if(define("common/inherits",[],function(){return"function"==typeof Object.create?function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:function(t,e){t.super_=e;var n=function(){};n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t}}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/errorgen",["lodash","common/inherits"],function(_,inherits){function detectStacktrace(){try{throw new Error("probing")}catch(t){var e=t.stack;if(!e)return!1;try{e=e.substring(1)}catch(n){return!1}}return!0}function detectStackHasMessage(){try{throw new Error("probing")}catch(t){var e=t.stack;return/^Error: probing\n/.test(e)?!0:!1}}function detectMutableStacktrace(){function t(t){this.message=t;var e=(new Error).stack;this.stack=e.substring(1)}inherits(t,Error);try{throw new t("probing")}catch(e){return e.stacktrace?!1:e instanceof t&&"probing"===e.message?!0:!1}}function detectNeedToString(){function t(t){this.message=t,this.name="Tmp"}inherits(t,Error);var e;try{throw new Error("probing")}catch(n){e=n.toString().replace(/^Error/,"Tmp")}try{throw new t("probing")}catch(n){try{var r=n.toString();return r!==e}catch(o){return!0}}}function GoInstantError(){throw new Error("GoInstantError is an abstract base-class")}function generateClass(name){var curClass;return eval(TEMPLATE.replace(/X/g,name)+"\ncurClass = "+name+";"),inherits(curClass,GoInstantError),canCaptureStacktrace&&(curClass.prototype.name=name),needsToString&&(curClass.prototype.toString=function(){return this.name+": "+this.message}),inWindow||(curClass.prototype.inspect=function(){return"["+this.toString()+"]"}),curClass}function errorgen(t){_.isString(t)&&(t=[t]);var e={};return _.each(t,function(t){e[t]=generateClass(t)}),e}var inWindow=!1;try{inWindow=!!window}catch(e){}var canCaptureStacktrace=!!Error.captureStackTrace,hasStacktrace=canCaptureStacktrace||detectStacktrace(),stackHasMessage=hasStacktrace&&detectStackHasMessage(),hasMutableStacktrace=canCaptureStacktrace||detectMutableStacktrace(),needsToString=detectNeedToString(),scrubStack=function(){};scrubStack=stackHasMessage?function(t){return t.replace(/\n[^\n]+\n/,"\n")}:function(t){return t.substr(t.indexOf("\n")+1)},inherits(GoInstantError,Error);var TEMPLATE="";return TEMPLATE+="function X(message) {\n",TEMPLATE+="  \n",TEMPLATE+="  this.message = message;\n",canCaptureStacktrace||(TEMPLATE+="  this.name = 'X';\n"),hasStacktrace&&(canCaptureStacktrace?TEMPLATE+="  Error.captureStackTrace(this, this.name);\n":hasMutableStacktrace&&(TEMPLATE+="  var s = '' + new Error().stack;\n",TEMPLATE+="  this.stack = scrubStack(s);\n")),TEMPLATE+="}\n",errorgen.hasStacktrace=hasStacktrace,errorgen.GoInstantError=GoInstantError,errorgen}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/errors",["lodash","common/errorgen"],function(t,e){var n={CollisionError:100,RoomSessionStateError:200,RoomSizeError:201,ConnectionError:202,AuthenticationError:203,PermissionError:204,NotMemberError:205,NotConnectedError:206,NoUserError:207,SynchronizationError:208,KeyNameError:300,InvalidRequestError:302,ArgumentError:303,NonLeafKeyError:304,DuplicateCallError:305,CouldNotCompleteError:306,NotInitializedError:307},r=t.invert(n),o=e(t.keys(n));return t.each(n,function(t,e){o[e].prototype.code=t}),o.GoInstantError=e.GoInstantError,o.build=function(t,e){var n;n="number"==typeof e?e:e&&e.meta?e.meta.code:0;var i=r[n],s=o[i]||Error;return new s(t)},o}),define("platform/socket",["eio","lodash","eventutil","eventemitter2","util/backoff","util/logging","global/navigator","global/window","common/errors"],function(t,e,n,r,o,i,s,a,u){function c(t,n,i,a,c){if(this.connectUrl=t,!e.isString(this.connectUrl))throw new u.ArgumentError("connectUrl must be a string");if(this.account=n,!e.isString(this.account))throw new u.ArgumentError("account must be a string");if(this.app=i,!e.isString(this.app))throw new u.ArgumentError("app must be a string");if(!e.isString(a)&&!e.isPlainObject(a)&&null!==a)throw new u.ArgumentError("user must be a jwt or a default guest object");if(this.token=null,this._guestDefaults=null,e.isPlainObject(a)){try{JSON.stringify(a)}catch(l){throw new u.ArgumentError("user defaults are not serializable")}this._guestDefaults=a}else this.token=a;this._saveGuestId=!0,this.guestId=null,e.has(c,"guestId")&&(this._saveGuestId=!1,this.guestId=c.guestId),this._state=d,this.onlyPolling=e.some(p,function(t){return s.userAgent.indexOf(t)>-1}),this._sendAuth=null,this.storageVersion=1;var f=e.defaults({},c,h);this._backoff=new o(f),this._cleanupBackoff=function(){},this._cleanupListeners=function(){},this._emitter=new r}var l=0,f=700,p=["iPhone","Android","iPad"],h={startDelay:100,maxDelay:3e3,failAfter:20},d="disconnected",m="connecting",v="handshaking",y="connected",g="reconnecting",_="rehandshaking",b="disconnecting",w=0,k=1,E=2,S=3,x=4,A=5,j={};j[d]=[m],j[m]=[v,b,d],j[v]=[y,m,b],j[y]=[b,g],j[g]=[_,b,d],j[_]=[y,g,b],j[b]=[d];var O=i.get("platform/socket");return c.prototype._transition=function(t){var n=j[this._state],r={prev:this._state,next:t};if(!e.contains(n,t))throw O.error("Invalid socket state transition",r),new Error('Cannot transition socket from "'+this._state+'" '+'to "'+t+'"!');O.debug("Socket state transition",r),this._state=t},c._makeSocket=function(e,n){return t.Socket(e,n)},c.prototype.send=function(t){if(this._state===d)throw new u.ConnectionError("Socket is not connected (send)");var e;try{e=JSON.stringify(t)}catch(n){throw new u.ArgumentError("JSON Stringify Error: "+n.message)}this.eiSocket.send(e)},c.prototype.on=function(t,e){this._emitter.on(t,e)},c.prototype.off=function(t,e){this._emitter.off(t,e)},c.prototype.close=function(){function t(t){r._transition(d),r._emitter.emit("error",t)}function e(){r._transition(d),r._emitter.emit("disconnect")}this._transition(b),this._cleanup();var r=this;n.register(this.eiSocket,"!error",t,this.eiSocket,"!close",e),this.eiSocket.close(),this.eiSocket=null},c.prototype._getSocketOptions=function(){return{transports:this.onlyPolling?["polling"]:["polling","websocket"],query:{},path:"/"+encodeURIComponent(this.account)+"/"+encodeURIComponent(this.app)}},c.prototype.connect=function(t){this._transition(m);var r=this._getSocketOptions();if(this._cleanupBackoff=n.register(this._backoff,"fail",e.bind(this._onRetryConnectFail,this),this._backoff,"finish",e.bind(this._retryConnect,this)),n.register(this._emitter,"!connect",e.bind(t,this,null),this._emitter,"!error",e.bind(t,this)),this.token)this.token.length>f?this._sendAuth=JSON.stringify(["AUTH",this.token]):r.query.jwt=this.token;else if(this._guestDefaults)try{this._sendAuth=JSON.stringify(["AUTH","GUEST",this._guestDefaults])}catch(o){return this._socketError("Guest defaults cannot be serialized")}else r.query.guest=1;var i=this._getGuestId();i&&(r.query.gid=i),r.query.c=l++ +"-"+Math.floor(1e4*Math.random());try{this.eiSocket=c._makeSocket(this.connectUrl,r)}catch(o){return this._socketError("initiation failed")}this._backoff.reset(),this._cleanupListeners=n.register(this.eiSocket,"!error",e.bind(this._backoff.start,this._backoff),this.eiSocket,"!open",e.bind(this._handshaking,this))},c.prototype._getGuestId=function(){var t=this.guestId;if(this._saveGuestId)try{t=a.localStorage.getItem("giGuestId")}catch(e){}return t},c.prototype._setGuestId=function(t){if(this._saveGuestId)try{a.localStorage.setItem("giGuestId",t)}catch(e){}this.guestId=t,this.eiSocket.query.gid=t},c.prototype._setStorageProtocol=function(t){1!==t&&O.warn("Storage Protocol Version is unstable"),this.storageVersion=t,this.eiSocket.query.storageProtocolVersion=t},c.prototype._onConnectMessage=function(t){var e;try{e=JSON.parse(t)}catch(n){return this._socketError("malformed message")}var r=e[w];if("ERROR"===r){var o=u.build(e[k],0+e[E]);return this._socketError(o)}if("USER"===r){var i=e[k];e.length===A&&(this._setStorageProtocol(e[x]),this._setGuestId(e[S])),e.length===A-1&&this._setStorageProtocol(e[x-1]),this._connected(i)}},c.prototype._socketError=function(t){var e="Could not connect: ";(this._state===g||this._state===_)&&(e="Could not reconnect: "),this._state===v||this._state===_?this.close():this._transition(d),t instanceof Error?t.message=e+t.message:t=e+t,O.error("Socket error",{err:t}),this._emitter.emit("error",t)},c.prototype._setupHandshake=function(t,r){function o(){i._transition(r),i._backoff.start()}this._transition(t),null!==this._sendAuth&&(O.debug("sending auth token message"),this.eiSocket.send(this._sendAuth));var i=this;this._cleanupListeners=n.register(this.eiSocket,"!close",o,this.eiSocket,"message",e.bind(this._onConnectMessage,this))},c.prototype._handshaking=function(){this._setupHandshake(v,m)},c.prototype._rehandshaking=function(){this._setupHandshake(_,g)},c.prototype._connected=function(t){function r(){o._transition(g),o._backoff.start(),o._emitter.emit("disconnect")}this._transition(y),this._backoff.reset();var o=this;this._cleanupListeners(),this._cleanupListeners=n.register(this.eiSocket,"!close",r,this.eiSocket,"message",e.bind(this._emitter.emit,this._emitter,"message")),this._emitter.emit("connect",t)},c.prototype._cleanup=function(){this._backoff.reset(),this._cleanupBackoff(),this._cleanupListeners()},c.prototype._onRetryConnectFail=function(){this._cleanup(),this._socketError("Maximum number of reconnect attempts reached.")},c.prototype._retryConnect=function(){var t;if(this._state===m)t=this._handshaking;else{if(this._state!==g)return this._socketError("Invalid state seen during retry");t=this._rehandshaking}this._cleanupListeners=n.register(this.eiSocket,"!error",e.bind(this._backoff.start,this._backoff),this.eiSocket,"!open",e.bind(t,this)),this.eiSocket.open()},c}),define("util/validation",["lodash"],function(t){var e={};return e.optionalCallback=function(e){return t.isUndefined(e)||t.isNull(e)||t.isFunction(e)},e.requiredCallback=function(e){return!(!e||!t.isFunction(e))},e.contained=function(e,n){return t.contains(e,n)},e.subset=function(e,n){var r=t.difference(e,n);return 0===r.length},e.isFunction=function(e){return t.isFunction(e)},e.throwOrCallback=function(e,n){if(!t.isFunction(n))throw e;n(e)},e}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/constants",[],function(){var t={};t.SLASH_SPACE_TRIMMER=/^[\/\s]+|[\/\s]+$/g;var e="a-zA-Z0-9%",n=e+".",r=e+".@_:-",o="["+n+"]["+r+"]{0,127}",i="["+e+"]["+r+"]{0,127}";t.NAME_REGEX_BODY=i;var s="["+r+"]{1,128}";return t.INTERNAL_NAME_REGEX_BODY=s,t.NAME_REGEX=new RegExp("^"+i+"$"),t.INTERNAL_NAME_REGEX=new RegExp("^"+s+"$"),t.KEY_REGEX="(?:(?:/)?"+o+"(?:/|)?)*",t.NAME_RULES_ENGLISH=" names are case sensitive, must be alphanumeric (1-128 chars), and can include non-leading -, _, ., @, and :",t.PROVIDER_NAME_REGEX=/^(?!session$)[a-z0-9_]+$/,t}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/key_name",["lodash","common/constants"],function(t,e){var n={},r=e.SLASH_SPACE_TRIMMER;return n.clean=function(e){if("/"===e)return"/";if(!t.isString(e))return null;if(e="/"+e.replace(r,""),1===e.length)return null;var o=n.validate(e);return o?e:null},n.validate=function(n){if(!t.isString(n)||n.length<1||"/"!==n[0])return!1;if("/"===n)return!0;var r=n.split("/");r.shift(),".users"===r[0]&&(r.shift(),r.length>0&&e.INTERNAL_NAME_REGEX.test(r[0])&&r.shift());var o=t.every(r,function(t){return e.NAME_REGEX.test(t)});return o},n}),define("platform/channel",["eventemitter2","lodash","util/validation","common/key_name","util/resolver"],function(t,e,n,r,o){function Channel(e,n){if(this._room=e,this.name=r.clean(n),null===this.name)throw new Error("Invalid channel name: "+n);this._emitter=new t}return Channel.COMMANDS={message:"MESSAGE"},Channel.DEFAULT_COMMAND_OPTIONS={local:!0},Channel._Resolver=o,Channel.VALID_EVENTS=e.keys(Channel.COMMANDS),Channel.prototype.room=function(){return this._room},Channel.prototype._resolveOptionsAndCallback=function(t,n){return e.isPlainObject(t)?t=e.defaults(t,Channel.DEFAULT_COMMAND_OPTIONS):(n=n||t,t=Channel.DEFAULT_COMMAND_OPTIONS),{options:t,cb:n}},Channel.prototype.on=function(t,e,n){this._room._on(this.name,Channel.VALID_EVENTS,t,e,n)},Channel.prototype.off=function(t,e){var n={local:!1,bubble:!1};this._room._off(this.name,Channel.VALID_EVENTS,t,n,e)},Channel.prototype.message=function(t,r,o){var i;e.isUndefined(t)&&(i=new Error("Message cannot be undefined"));var s=this._resolveOptionsAndCallback(r,o);if(n.optionalCallback(s.cb)||(i=new Error("Callback should be a function or undefined")),i)return n.throwOrCallback(i,s.cb);var a=new Channel._Resolver(s.cb,this,["value","context"]),u=s.options;o=a.cb;var c={key:this.name,value:t,options:u};return this._room._request(Channel.COMMANDS.message,c,o),a.promise},Channel.prototype.equals=function(t){return t instanceof this.constructor?this.name!==t.name?!1:this._room.equals(t._room)?!0:!1:!1},Channel}),define("util/deprecate",["global/window"],function(t){function e(e){if(t.console){var n="Usage of deprecated GoInstant feature: "+e.name;e.date&&(n+="\nThis feature will be removed on: "+e.date.toDateString()),e.url&&(n+="\nLearn more at: "+e.url),t.console.warn(n)}}return{warn:e}}),define("platform/watch_registry",["lodash"],function(t){function e(){this._listeners=[]}return e.prototype.add=function(t){var e=this._wrap(t);return this._listeners.push(e),e},e.prototype.remove=function(t){var e=this._indexOf(t),n=null;return e>=0&&(n=this._listeners[e],this._listeners.splice(e,1)),n},e.prototype.clear=function(){var t=this._listeners;return this._listeners=[],t},e.prototype._indexOf=function(e){return t.findIndex(this._listeners,{__wrapped:e})},e.prototype._wrap=function(t){var e=function(){var t=Array.prototype.slice.call(arguments);e.__wrapped.apply(this,t)};return e.__wrapped=t,e},e}),define("util/inherits",[],function(){function t(t,n){t.super_=n,t.prototype=e(n.prototype)}function e(t){function e(){}if(arguments.length>1)throw new Error("Object.create implementation only accepts the first parameter");return e.prototype=t,new e}return t}),define("util/state_machine",["lodash"],function(t){function e(e,n){if(!t.isString(e))throw new Error("The start state must be a string");if(!t.isObject(n))throw new Error("Must provide a fsm definition");if(t.size(n)<2)throw new Error("There must be two or more states");if(!n[e])throw new Error("Start state does not exist");var r=t.keys(n),o={};t.each(r,function(t){o[t]=t}),t.each(n,function(e){t.each(e,function(e){if(!t.contains(r,e))throw new Error("Unknown state: "+e)})}),this.states=o,this._fsm=n,this.current=e}return e.prototype.transition=function(e){if(!t.isString(e))throw new Error("State must be a string");if(!this._fsm[e])throw new Error("Invalid state provided: "+e);if(!t.contains(this._fsm[this.current],e))throw new Error("Cannot transition from "+this.current+" to "+e);this.current=e},e}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/obj",["lodash","common/errors"],function(t,e){function n(e,n){var r=e.node;if(!t.isUndefined(r[n])){if(t.keys(r).length>1&&!t.isPlainObject(r[n]))throw new Error("Impossible to infer type, conflict at node");if(!t.isPlainObject(r[n]))return e.node=r[n],null!==e.parent&&(e.parent.node[e.name]=r[n]),void 0;t.merge(r,r[n]),delete r[n]}}function r(e,n){if(!t.isPlainObject(e))throw new Error("first argument must be an object");if(!t.isString(n)&&!t.isArray(n))throw new Error("undecorate only supports strings and arrays to describe removals")}function o(t,e,n){this.name=t,this.node=e,this.parent=n}var i={};return i.compose=function(t,e){var n=[];return i.iterate(e,function(){if(this.isLeaf()){for(var e=[],r=this,o=r.node;r.parent;)e.unshift(r.name),r=r.parent;e.unshift(t),n.push(e.join("/")),n.push(o)}}),n},i.pick=function(e,n,r){r=r||"/";var o=n.split(r),i=e;if(o=t.filter(o,function(t){return""!==t}),(null===i||void 0===i)&&o.length>=0)return void 0;for(var s=0;s<o.length;++s){if(i=i[o[s]],null===i&&s+1<o.length)return void 0;if(void 0===i)return void 0}return i},i.rZip=function(e,n,r,o){var i=n.split("/");i=t.filter(i,function(t){return""!==t});var s=e;return t.each(i,function(e,n){if(t.isPlainObject(s[e])||(s[e]={}),n>=i.length-1&&(s[e]=r),o){var a=i[n-1];o(s,a)}s=s[e]}),e},i.remove=function(n,r,o,i){if(!t.isObject(n))throw new Error("Provided blob is not an object");o&&o.clone&&(n=t.cloneDeep(n));var s=r.split("/");s=t.filter(s,function(t){return""!==t});var a,u=!0,c=n,l=[n],f=s.length-1;for(a=0;f>a;a++){if(c=c[s[a]],void 0===c){if(o&&t.has(o,"throws")&&!o.throws){u=!1;break}throw new e.KeyNameError("Path does not exist in object")}l.push(c)}u&&delete c[s[f]];for(var p,h=a;h>=0;h--)p=s[h],0===t.size(l[h][p])&&delete l[h][p],i&&i(l[h]);return n},i.decorate=function(e,n,r){return i.iterate(e,function(){if(!this.isHead()){for(var e=this,o=!1;e;){if(r&&e.name==r){o=!0;break}e=e.parent}if(!(o||r&&this.name==r)){if(this.isLeaf()){var i=this.parent.node[this.name];return this.parent.node[this.name]={},this.parent.node[this.name][n]=i,void 0}var s={};s[n]=t.cloneDeep(this.node);var a=this;t.each(a.node,function(t,e){e!==n&&delete a.node[e]}),t.merge(this.node,s)}}}),e},i.undecorate=function(e,o,s){r(e,o),s&&(e=t.cloneDeep(e)),t.isString(o)&&(o=[o]);var a=[],u=[];t.each(o,function(t){return"!"===t[0]?a.push(t.substring(1,t.length)):u.push(t)});var c=i.iterate(e,function(){var e=this;t.each(u,function(n){t.isNull(e.node[n]&&!t.isUndefined(e.node[n]))||delete e.node[n]}),t.each(a,function(t){n(e,t)})});return c.node},i.iterate=function(e,n){var r,i=[e],s=[],a=i.shift();r=new o(null,a,null);for(var u=r;r;){s.unshift(r);for(var c=t.keys(r.node),l=0;l<c.length;++l){var f=new o(c[l],r.node[c[l]],r);i.push(f)}r=i.shift()}return t.each(s,function(e){t.bind(n,e)()}),u},o.prototype.isLeaf=function(){var e=t.isPlainObject(this.node),n=e&&0===t.size(this.node);return n?!0:!e},o.prototype.isHead=function(){return null===this.parent},i}),define("expression/filter",["lodash","common/obj","common/errors"],function(t,e,n){function r(e){if(!t.isPlainObject(e))throw new n.ArgumentError("Must provide an object for expression");this._expr=e,this.filter([{name:"test",value:"empty"}],!0)}var o={object:t.isPlainObject,array:t.isArray,integer:function(e){return t.isNumber(e)&&0===e%1},"float":function(e){return t.isNumber(e)&&0!==e%1},string:t.isString,"boolean":t.isBoolean,"null":t.isNull};return r.prototype.filter=function(r,i){function s(e,r,o,s){if(i&&!t.isPlainObject(e))throw new n.ArgumentError("Expected an object at path: "+s);var c=t.keys(e);if(0===c.length)return!0;var l=a(e);if(l)return u(e[l],r,o,s+"/"+l,l);for(var f,p,h,d=0;d<c.length;++d)if(f=c[d],p=s+"/"+f,h=o+"/"+f,"$"!==f[0]){if(t.isPlainObject(e[f])&&(l=a(e[f]))){if(u(e[f][l],r,h,p,l))continue;return!1}if(!u(e[f],r,h,p,"$eq"))return!1}else if(!u(e[f],r,o,p,f))return!1;return!0}function a(e){if(!t.isPlainObject(e))return!1;var n=t.keys(e);return 1===n.length&&"$"===n[0][0]?n[0]:!1}function u(r,s,a,u,h){h||(h="$eq");var d=e.pick(s,a);switch(h=h.toLowerCase()){case"$type":if(i&&!o[r])throw new n.ArgumentError("$type value given is not valid at "+u);return o[r](d);case"$exists":return void 0!==d===r;case"$all":if(i&&!t.isArray(r))throw new n.ArgumentError("$all requires an array at "+u);return t.isEqual(d,r);case"$eq":return t.isEqual(d,r);case"$ne":return t.isArray(r)?!t.isEqual(d,r):d!==r;case"$in":if(i&&!t.isArray(r))throw new n.ArgumentError("$in operators require their value to be an array at "+u);return t.contains(r,d);case"$nin":if(i&&!t.isArray(r))throw new n.ArgumentError("$nin operators require their value to be an array at "+u);return!t.contains(r,d);case"$size":return t.isArray(d)?d.length===r:!1;case"$gt":if(i&&t.isObject(r))throw new n.ArgumentError("$gt operator must be a primitive value at "+u);return d>r;case"$lt":if(i&&t.isObject(r))throw new n.ArgumentError("$lt operator must be a primitive value at "+u);return r>d;case"$lte":if(i&&t.isObject(r))throw new n.ArgumentError("$lte operator must be a primitive value at "+u);return r>=d;case"$gte":if(i&&t.isObject(r))throw new n.ArgumentError("$gte operator must be a primitive value at "+u);return d>=r;case"$or":return p(r,s,a,u);case"$and":return f(r,s,a,u);case"$nor":return!p(r,s,a,u);case"$nand":return!f(r,s,a,u);case"$value":return l(r,s,a,u);case"$name":return c(r,s,a,u);default:throw new n.ArgumentError("Unknown operator["+h+"] at "+u)}}function c(n,r,o,i){var u=t.keys(e.pick(r,o));return a(n)||(n={$eq:n}),t.any(u,function(t,e){return s(n,u,"/"+e,i)})}function l(e,r,o,i){if(/\/\$value$/.test(i)){var u=t.values(r);if(1!==u.length)throw new n.ArgumentError("$value should only have a single value associated "+u);r=t.values(r)[0]}return a(e)||(e={$eq:e}),s(e,r,o,i)}function f(e,r,o,a){if(i&&!t.isArray(e))throw new n.ArgumentError("$and operator requires value to be an array at "+a);for(var u,c,l=0;l<e.length;++l){if(u=e[l],c=a+"/"+l,i&&!t.isPlainObject(u))throw new n.ArgumentError("$and operator members must be objects at "+a);if(!s(u,r,o,c))return!1}return!0}function p(e,r,o,a){if(i&&!t.isArray(e))throw new n.ArgumentError("$or operator requires value to be an array at "+a);for(var u,c,l=0;l<e.length;++l){if(u=e[l],c=a+"/"+l,i&&!t.isPlainObject(u))throw new n.ArgumentError("$or operator members must be objects at "+a);if(s(u,r,o,c))return!0}return!1}if(!t.isArray(r)){if(!t.isPlainObject(r))throw new Error("ResultGenerator expected array passed to filter.");r=[r]}i||(i=!1);var h=this;return t.filter(r,function(e){var n=e.value;return t.isObject(n)||(n={},n[e.name]=e.value),s(h._expr,n,"","")})},r}),define("expression/sort",["lodash","common/obj","common/errors"],function(t,e,n){function r(e){if(t.isUndefined(e))return this._order=[],this._direction=[],void 0;if(!t.isPlainObject(e))throw new n.ArgumentError("Sorting options must be an object: "+e);e=t.cloneDeep(e),t.each(e,function(r,i){if(!t.isNumber(r)||!t.contains([-1,1],r)){if(t.isString(r)&&(r=r.toLowerCase()),!o[r])throw new n.ArgumentError("Invalid sort direction provided for "+i);e[i]=o[r]}}),t.each(e,function(t,n){"$value"===n?e.value=t:"$name"===n?e.name=t:e["value/"+n]=t,delete e[n]}),this._expr=e,this._order=t.keys(this._expr),this._direction=t.values(this._expr)}var o={ascending:1,descending:-1,asc:1,desc:-1};return r.prototype.compare=function(t,n){if(0===this._order.length)return 1;for(var r,o,i=this._order,s=this._direction,a=0;a<i.length;++a)if(r=e.pick(t,i[a]),o=e.pick(n,i[a]),r!==o)return null===r||void 0===r?1:null===o||void 0===o?-1:s[a]*(r>o?1:-1);return 0},r.prototype.sort=function(e){if(!t.isArray(e))throw new Error("An array must be provided to sort.");return 0===this._order.length?e:e.sort(t.bind(this.compare,this))},r.prototype.determinePosition=function(t,e){if(0===this._order.length)return 1/0;for(var n,r=0,o=t.length-1,i=t.length,s=-1,a=0;s!==i-1;)a=Math.floor((r+o)/2),n=this.compare(t[a],e),0>=n?(s=a,r=a+1):(i=a,o=a-1);return i},r}),define("expression/page",["lodash","common/errors"],function(t,e){function n(n){var o,i;if(t.isUndefined(n))return this._start=0,this._size=r,void 0;if(t.isNumber(n)?(o=0,i=n):t.isArray(n)&&(o=n[0],i=n[1]),!t.isNumber(o)||0!==o%1||0>o)throw new e.ArgumentError("Page start must be an integer >= 0.");if(!t.isNumber(i)||0!==i%1||1>i)throw new e.ArgumentError("Page size must be an integer >= 1.");this._start=o,this._size=i}var r=1/0;return n.prototype.paginate=function(n,o,i){if(!t.isArray(n))throw new e.ArgumentError("Pagination results must be an array.");if(!t.isArray(o))throw new e.ArgumentError("Pagination operations must be an array.");if(this._size===r)return o;var s=[];if(0===o.length)return s;for(var a=0,u=o.length;u>a;++a){var c,l,f,p,h=o[a],d=this._pageRelative(h.previousPosition),m=this._pageRelative(h.position),v=d===Number.NEGATIVE_INFINITY,y=d===Number.POSITIVE_INFINITY,g=m===Number.NEGATIVE_INFINITY,_=m===Number.POSITIVE_INFINITY,b=!v&&!y&&null!==d,w=!g&&!_&&null!==m;switch(h.op){case"add":if(_)break;if(i&&!w)break;c=this._size-1,l=n[this._start+this._size],l&&!i&&s.push({op:"remove",name:l.name,position:null,previousPosition:c,value:t.cloneDeep(l.value)}),f=w?m:0,p=n[f+this._start],p&&s.push({op:"add",name:p.name,position:f,previousPosition:null,value:t.cloneDeep(p.value)});break;case"update":if(i)throw new e.ArgumentError("Initialization should not contain update events.");w&&(h.previousPosition=d,h.position=m,s.push(h));break;case"remove":if(i)throw new e.ArgumentError("Initialization should not contain remove events.");if(y)break;b?(c=d,l={name:h.name,value:h.value}):(c=0,l=n[c+this._start-1]),l&&s.push({op:"remove",name:l.name,position:null,previousPosition:c,value:t.cloneDeep(l.value)}),f=this._size-1,p=n[this._start+this._size-1],p&&s.push({op:"add",name:p.name,position:f,previousPosition:null,value:t.cloneDeep(p.value)});break;default:throw new e.ArgumentError("Operation op is invalid: "+h.op)}}return s},n.prototype.slice=function(e){if(!t.isArray(e)||0===e.length)return[];var n=this._start,o=this._start+this._size;return this._size===r&&(o=e.length),e.slice(n,o)},n.prototype._pageRelative=function(t){if(null===t||void 0===t)return null;var e=t-this._start;return 0>e?Number.NEGATIVE_INFINITY:e>=this._size?Number.POSITIVE_INFINITY:e},n}),define("expression/index",["lodash","common/errors"],function(t,e){function n(){this._nameMap={},this._posMap={},this._dataMap={},this._size=0}return n.prototype.set=function(n){if(!t.isArray(n))throw new e.ArgumentError("Items must be an array");for(var r=[],o=this._size-1;o>=0;--o)r.unshift(this.remove(this._posMap[o])[0]);this._size=0,this._nameMap={},this._posMap={},this._dataMap={};for(var i,s=0;s<n.length;s++)i=n[s],r.push(this.add(i.name,s,i.value)[0]);return this._size=n.length,r},n.prototype.add=function(n,r,o){if(void 0!==this._nameMap[n])throw new e.ArgumentError("Item already exists in index: "+n);if(r>this._size)throw new e.ArgumentError("Position is out of bounds: "+r);this._rightShift(r,this._size-1),this._posMap[r]=n,this._nameMap[n]=r,this._dataMap[n]=o,this._size+=1;var i=[{op:"add",name:n,position:r,previousPosition:null,value:t.cloneDeep(o)}];return i},n.prototype.remove=function(n){var r=this._nameMap[n];if(void 0===r)throw new e.ArgumentError("Item is not available in result index: "+n);var o=t.cloneDeep(this._dataMap[n]);delete this._nameMap[n],delete this._posMap[r],delete this._dataMap[n],this._leftShift(r+1,this._size-1),delete this._posMap[this._size-1],this._size-=1;var i=[{op:"remove",name:n,position:null,previousPosition:r,value:o}];return i},n.prototype.update=function(n,r,o){var i=this._nameMap[n];if(void 0===i)throw new e.ArgumentError("Item is not available in result index: "+n);if(r>=this._size)throw new e.ArgumentError("Position is out of bounds: "+r);void 0===o&&(o=this.data(n));var s=t.cloneDeep(this._dataMap[n]);if(this._dataMap[n]=o,i===r)return[{op:"update",name:n,position:r,previousPosition:r,value:t.cloneDeep(o)}];var a=[];return delete this._posMap[i],a.push({op:"remove",name:n,position:r,previousPosition:i,value:s}),i>r?this._rightShift(r,i-1):this._leftShift(i+1,r),this._posMap[r]=n,this._nameMap[n]=r,a.push({op:"add",name:n,position:r,previousPosition:i,value:t.cloneDeep(o)}),a},n.prototype.data=function(e){return t.cloneDeep(this._dataMap[e])},n.prototype.position=function(t){var e=this._nameMap[t];return void 0===e?-1:e},n.prototype._leftShift=function(t,e){for(var n,r,o=t;e>=o;++o)r=this._posMap[o],n=o-1,this._posMap[n]=r,this._nameMap[r]=n},n.prototype._rightShift=function(t,e){for(var n,r,o=e;o>=t;o--)n=this._posMap[o],r=o+1,this._posMap[r]=n,this._nameMap[n]=r},n}),define("expression/engine",["lodash","common/obj","common/errors","expression/filter","expression/sort","expression/page","expression/index"],function(t,e,n,r,o,i,s){function a(e,a){if(!t.isPlainObject(a))throw new n.ArgumentError("Must provide an object for opts");e=t.cloneDeep(e),a=t.cloneDeep(a),this._results=[],this._index=new s,this._filterer=new r(e),this._sorter=new o(a.sort),this._paginator=new i(a.limit)}return a.prototype.set=function(e,n){if(!t.isArray(e))throw new Error("An array must be provided");var r=this._filterer.filter(e);r=this._sorter.sort(r);var o=this._index.set(r);return this._results=r,this._paginator.paginate(this._results,o,n)},a.prototype.add=function(e){if(!t.isObject(e))throw new n.ArgumentError("Expects an object to be provided");if(0===this._filterer.filter([e]).length)return[];var r=this._sorter.determinePosition(this._results,e);1/0===r&&(r=this._results.length);var o=this._index.add(e.name,r,e.value);return this._apply(o),this._paginator.paginate(this._results,o)},a.prototype.update=function(e){if(!t.isObject(e))throw new n.ArgumentError("Expects an object to be provided");var r=0!==this._filterer.filter([e]).length,o=void 0!==this._index.data(e.name);if(!r&&!o)return[];if(!r&&o)return this.remove(e);if(r&&!o)return this.add(e);var i=this._index.position(e.name),s=this._results.slice(0,i).concat(this._results.slice(i+1,this._results.length)),a=this._sorter.determinePosition(s,e);1/0===a&&(a=i);var u=this._index.update(e.name,a,e.value);return this._apply(u),this._paginator.paginate(this._results,u)},a.prototype.remove=function(e){if(!t.isObject(e))throw new n.ArgumentError("Expects an object to be provided");if(void 0===this._index.data(e.name))return[];var r=this._index.remove(e.name);return this._apply(r),this._paginator.paginate(this._results,r)},a.prototype.get=function(){return t.cloneDeep(this._paginator.slice(this._results))},a.prototype._apply=function(t){for(var e,n=0;n<t.length;++n)switch(e=t[n],e.op){case"add":this._results.splice(e.position,0,{name:e.name,value:e.value});break;case"update":this._results[e.position]={name:e.name,value:e.value};break;case"remove":this._results.splice(e.previousPosition,1)}},a}),define("platform/query",["lodash","eventemitter2","async","util/inherits","util/validation","util/state_machine","util/resolver","common/errors","common/obj","expression/engine"],function(t,e,n,r,o,i,s,a,u,c){function Query(n,r,o){if(!t.isObject(n))throw new a.ArgumentError("Provided key must be an instance of Key");this._engine=new c(r,o||{}),this._key=n,this._registry={},this._data={},this._state=new i("NOT_INITIALIZED",{NOT_INITIALIZED:["INITIALIZING","DESTROYED"],INITIALIZING:["ERROR","HAS_CHILDREN","HAS_NO_CHILDREN","DESTROYED"],HAS_NO_CHILDREN:["ERROR","HAS_CHILDREN","DESTROYED"],HAS_CHILDREN:["ERROR","HAS_NO_CHILDREN","DESTROYED"],ERROR:["DESTROYED"],DESTROYED:[]}),this._emitter=new e}function l(t,e){var n=e.replace(t,"");return n.replace(/^\/|\/$/g,"")}function f(t,e){var n=l(t,e),r=n.split("/");return 0===r.length?null:r[0]}var p={change:!0,error:!0,add:!0,remove:!0,update:!0};return Query._Resolver=s,Query.prototype.key=function(){return this._key},Query.prototype.on=function(e,n){if(!t.isString(e))throw new a.ArgumentError("The event must be a string");if(!p[e])throw new a.ArgumentError(e+" is not a valid event for a Query");if(!t.isFunction(n))throw new a.ArgumentError("A listener must be a function");this._emitter.on(e,n)},Query.prototype.off=function(e,n){if(!t.isUndefined(e)&&!t.isString(e))throw new a.ArgumentError("The event must be a string if supplied");if(!t.isUndefined(e)&&!p[e])throw new a.ArgumentError("The event must be a valid query event if supplied");if(!t.isUndefined(n)&&!t.isFunction(n))throw new a.ArgumentError("The listener must be a function if supplied");if(t.isUndefined(e)&&!t.isUndefined(n))throw new a.ArgumentError("You must provide an event if you provide a listener");return e&&n?this._emitter.removeListener(e,n):(this._emitter.removeAllListeners.apply(this._emitter,arguments),void 0)},Query.prototype.execute=function(e){if(!t.isUndefined(e)&&!t.isFunction(e))throw new a.ArgumentError("If a callback is provided it must be a function");
var n=new Query._Resolver(e,this);if(e=n.cb,this._state.current!==this._state.states.NOT_INITIALIZED)return e(new a.DuplicateCallError("Query#execute can only be called once per query."));this._state.transition("INITIALIZING");var r=this;return r._get(function(n,o){if(n)return r._state.transition("ERROR"),e(n);if(r._state.current===r._state.states.DESTROYED)return e(new a.CouldNotCompleteError("Query#destroy called during Query#execute -- cannot complete execute"));r._registry={set:t.bind(r._handleUpdate,r),add:t.bind(r._handleUpdate,r),remove:t.bind(r._handleRemove,r)},t.each(r._registry,function(t,e){r._key.on(e,{local:!0,bubble:!0},t)});var i=t.isArray(o)&&0===t.size(o)?"HAS_NO_CHILDREN":"HAS_CHILDREN";r._state.transition(i),r._broadcast(r._engine.set(o,!0)),e(null,r._engine.get())}),n.promise},Query.prototype.get=function(e){if(!t.isUndefined(e)&&!t.isFunction(e))throw new a.ArgumentError("You must provide a function as a callback to Query#get");var n=new Query._Resolver(e,this);e=n.cb;var r=["ERROR","DESTROYED","NOT_INITIALIZED","INITIALIZING"];if(t.contains(r,this._state.current))return o.throwOrCallback(new a.NotInitializedError("Cannot call #get if #execute has not completed, or an error has occurred"),e);var i=this._engine.get();return t.defer(function(){e(null,i)}),n.promise},Query.prototype.destroy=function(){var e=this;t.each(this._registry,function(t,n){e._key.off(n,t)}),e._emitter.removeAllListeners(),e._engine=null,e._data=null,e._key=null,e._registry=null,e._state.transition("DESTROYED")},Query.prototype._get=function(e){var n=this;n._key.get(function(r,o){if(r)return e(r);if(null!==o&&(!t.isObject(o)||t.isArray(o)))return e(new a.NonLeafKeyError("Queries cannot occur on leaf-key's, the key must be a parent"));n._data=o||{};var i=n._mutate(n._data);e(null,i)})},Query.prototype._handleUpdate=function(e,n){if(t.contains(["HAS_CHILDREN","HAS_NO_CHILDREN"],this._state.current)){var r=n.addedKey?n.addedKey:n.key;if(!t.isPlainObject(e)&&n.currentKey===r)return this._emitter.emit("error",new a.NonLeafKeyError("Key["+r+"] has become a leaf-key, no-longer a queryable key"));t.isPlainObject(e)&&(e=t.cloneDeep(e)),e=this._normalize(e,n),t.merge(this._data,e),this._state.current===this._state.states.HAS_NO_CHILDREN&&this._state.transition("HAS_CHILDREN");var o=f(n.currentKey,r),i={name:o,value:u.pick(this._data,o)};this._broadcast(this._engine.update(i))}},Query.prototype._handleRemove=function(e,n){if(t.contains(["HAS_CHILDREN","HAS_NO_CHILDREN"],this._state.current)){var r;if(n.currentKey===n.key)return this._state.transition("HAS_NO_CHILDREN"),this._data={},r=this._engine.set([]),this._broadcast(r);var o=l(n.currentKey,n.key);try{this._data=u.remove(this._data,o,{clone:!0})}catch(i){if(i instanceof a.KeyNameError)return this._state.transition("ERROR"),this._emitter.emit("error",new a.SynchronizationError("Query has become out of sync with the current key value"));throw i}0===t.size(this._data)&&this._state.transition("HAS_NO_CHILDREN");var s=f(n.currentKey,n.key),c=u.pick(this._data,s),p={name:s,value:void 0===c?null:c};r=-1!==o.indexOf("/")&&void 0!==c?this._engine.update(p):this._engine.remove(p),this._broadcast(r)}},Query.prototype._normalize=function(t,e){if(!e.currentKey)throw new a.ArgumentError("invalid context provided");for(var n,r,o,i=e.addedKey?e.addedKey:e.key;i!==e.currentKey;)o=i.lastIndexOf("/"),n=i.slice(i.lastIndexOf("/")),n=n.replace("/",""),r={},r[n]=t,t=r,i=i.slice(0,o);return t},Query.prototype._mutate=function(e){if(!t.isObject(e)||t.isArray(e))throw new Error("Mutate requires an object");var n=[];return t.each(e,function(t,e){n.push({name:e,value:t})}),n},Query.prototype._broadcast=function(t){if(0!==t.length){for(var e,n=0;n<t.length;++n)e=t[n],this._emitter.emit(e.op,{name:e.name,value:e.value},{position:{current:e.position,previous:e.previousPosition},events:{current:n+1,total:t.length},event:e.op,child:e.name});this._emitter.emit("change",this._engine.get(),{event:"change"})}},Query}),define("platform/key",["lodash","async","util/resolver","util/validation","util/deprecate","common/key_name","platform/watch_registry","platform/query","common/errors"],function(t,e,n,r,o,i,s,Query,a){function Key(t,e){this._room=t,this.name=u(e),this._watchRegistry=new s}function u(t){var e=i.clean(t);if(null===e)throw new a.KeyNameError("Invalid key name: "+t);return e}function c(t,e){return r.optionalCallback(e)?void 0:"Key#"+t+" requires the callback to be a function if it is provided"}return Key.COMMANDS={get:"GET",set:"SET",remove:"REMOVE",add:"ADD"},Key.VALID_EVENTS=["set","remove","add"],Key.DEFAULT_COMMAND_OPTIONS={bubble:!0,local:!0},Key.DEFAULT_SET_OPTIONS={overwrite:!0},Key._Resolver=n,Key.prototype._childName=function(t){return this.name+u(t)},Key.prototype._parentName=function(){var t=this.name.split("/").slice(1,-1);return"/"+t.join("/")},Key.prototype.key=function(t){return new Key(this._room,this._childName(t))},Key.prototype.parent=function(){var t=this._parentName();return this.name==t?this:new Key(this._room,t)},Key.prototype.room=function(){return this._room},Key.prototype._sanitizeExpire=function(e){return t.has(e,"expire")?((null===e.expire||void 0===e.expire)&&delete e.expire,e):e},Key.prototype._resolveOptionsAndCallback=function(e,n){return t.isPlainObject(e)?e=t.defaults(e,Key.DEFAULT_COMMAND_OPTIONS):(n=n||e,e=Key.DEFAULT_COMMAND_OPTIONS),e=this._sanitizeExpire(e),{options:e,cb:n}},Key.prototype._cascade=function(e){e=t.isArray(e)?e:[e],e=t.map(e,function(t){return t instanceof Key?t.name:new Error("non-key")});var n=t.any(e,function(t){return t instanceof Error});return n?new Error("Non-key passed to cascade"):e},Key.prototype.set=function(e,n,r){if(t.isNull(e)||t.isUndefined(e))throw new Error("Key#set cannot be passed null or undefined. Use remove instead.");var o=this._resolveOptionsAndCallback(n,r),i=c("set",o.cb);if(i)throw new Error(i);var s=new Key._Resolver(o.cb,this,["value","context"]);if(n=o.options,r=s.cb,n=t.defaults(n,Key.DEFAULT_SET_OPTIONS),n.cascade&&(n.cascade=this._cascade(n.cascade),n.cascade instanceof Error))throw n.cascade;var a={key:this.name,value:e,options:n};return this._room._request(Key.COMMANDS.set,a,r),s.promise},Key.prototype.add=function(e,n,r){var o=this._resolveOptionsAndCallback(n,r),i=c("add",o.cb);if(i)throw new Error(i);var s=new Key._Resolver(o.cb,this,["value","context"]);if(n=o.options,r=s.cb,t.isNull(e)||t.isUndefined(e))throw new Error("Key#add cannot be passed null or undefined.");if(n.cascade&&(n.cascade=this._cascade(n.cascade),n.cascade instanceof Error))throw new Error(n.cascade);var a={key:this.name,value:e,options:n};return this._room._request(Key.COMMANDS.add,a,r),s.promise},Key.prototype.get=function(t){var e=c("get",t);if(e)throw new Error(e);var n=new Key._Resolver(t,this,["value","context"]);t=n.cb;var r={key:this.name};return this._room._request(Key.COMMANDS.get,r,t),n.promise},Key.prototype.remove=function(t,e){var n=this._resolveOptionsAndCallback(t,e),r=c("remove",n.cb);if(r)throw new Error(r);var o=new Key._Resolver(n.cb,this,["value","context"]);t=n.options,e=o.cb;var i={key:this.name,options:t};return this._room._request(Key.COMMANDS.remove,i,e),o.promise},Key.prototype.on=function(t,e,n){this._room._on(this.name,Key.VALID_EVENTS,t,e,n)},Key.prototype.off=function(t,e,n){this._room._off(this.name,Key.VALID_EVENTS,t,e,n)},Key.prototype.query=function(t,e){return new Query(this,t,e)},Key.prototype.watch=function(e,n){if(o.warn({name:"Key#watch",date:new Date(2014,3,1),url:"https://developers.goinstant.com/v1/javascript_api/key/watch.html"}),!t.isFunction(e))throw new Error("Key#watch listener must be a function");if(!r.optionalCallback(n))throw new Error("Key#watch optional callback must be a function");var i=this._watchRegistry.add(e),s={local:!0,bubble:!0},a=this;a.get(function(e){if(!e){var r=Array.prototype.slice.call(arguments,1);i.apply(this,r),t.each(Key.VALID_EVENTS,function(t){a.on(t,s,i)})}n&&n(e)})},Key.prototype.unwatch=function(e,n){o.warn({name:"Key#unwatch",date:new Date(2014,3,1),url:"https://developers.goinstant.com/v1/javascript_api/key/unwatch.html"});var i;if(r.optionalCallback(e)?r.optionalCallback(n)||(i=new Error("Key#unwatch optional callback must be a function")):i=new Error("Key#unwatch optional listener must be a function"),i)return r.throwOrCallback(i,n);var s;if(t.isFunction(e)){var a=this._watchRegistry.remove(e);if(!a)return i=new Error("Key#unwatch listener is not a watch function"),r.throwOrCallback(i,n);s=[a]}else s=this._watchRegistry.clear();var u=this;t.each(s,function(e){t.each(Key.VALID_EVENTS,function(t){u.off(t,e)})}),n&&n()},Key.prototype.equals=function(t){return t instanceof this.constructor?this.name!==t.name?!1:this._room.equals(t._room)?!0:!1:!1},Key}),define("platform/room",["lodash","async","util/resolver","platform/channel","platform/key","common/constants","common/errors","util/validation"],function(t,e,n,Channel,Key,r,o,i){function Room(e,n){if(!t.isString(n)||!r.NAME_REGEX.test(n))throw new Error(l+" Invalid room: "+n);this.name=n,this._connection=e,this.users=this.key("/.users")}var s=o.NotMemberError,a=o.NotConnectedError,u=i.throwOrCallback,c="You must connect to GoInstant before you can perform operations on a key or room",l="Room"+r.NAME_RULES_ENGLISH;Room.VALID_EVENTS=["join","leave"],Room.COMMANDS={join:"JOIN",leave:"LEAVE"};var f={local:!1,bubble:!1},p={local:!0,bubble:!1},h=[!0,!1],d=["local","bubble","listener","lastValue"];return Room._Resolver=n,Room.prototype.connection=function(){return this._connection},Room.prototype.join=function(n,r,o){function i(t){var e=s.self();e.get(function(e,n){return e?t(e):(t(null,s,n),void 0)})}var s=this;if(t.isFunction(r)&&(o=r,r=null),t.isFunction(o)&&!t.isPlainObject(n)&&!t.isNull(n))throw new Error("userObject must be an object");if(t.isFunction(n)&&(o=n,n=null),t.isUndefined(o)&&(o=function(){}),r&&!t.isPlainObject(r))throw new Error("opts must be an object");var a=new Room._Resolver(o,s,["room","user"]);o=a.cb;var u={key:"/.users",options:p};if(r&&t.has(r,"visible")){if(!t.isBoolean(r.visible))throw new Error("opts.visible must be a boolean");u.options=t.merge({visible:r.visible},u.options)}return this._request(Room.COMMANDS.join,u,function(r){if(r)return o(r);if(s._connection._joined(s),n){var a=s.key("/.users/"+s._connection._user.id);e.each(t.keys(n),function(t,e){a.key(t).set(n[t],e)},function(t){t?s.leave(function(){return o(t)}):i(o)})}else i(o)}),a.promise},Room.prototype.leave=function(e){var n=this;if(e||(e=function(){}),e&&!t.isFunction(e))throw new Error("callback must be a function");var r=new Room._Resolver(e,n);if(e=r.cb,!this._connection._socket)return u(new a(c),e);var o={key:"/.users",options:p};return this._request(Room.COMMANDS.leave,o,function(r,o,i){if(r)return e(r);if(n._connection._left(n),o){var s=t.cloneDeep(i||{});s.context=t.cloneDeep(i||{}),s.options={bubble:!1,local:!0},s.local=!0,n._connection._registry.emit(s)}n._off(),e()}),r.promise},Room.prototype.joined=function(){return this._connection._isJoined(this)},Room.prototype.user=function(e){if(!t.isString(e))throw new o.ArgumentError("You must pass a string for a userId");return this.key("/.users/"+e)},Room.prototype.self=function(){if(!this._connection._socket||!this._connection._user)throw new a(c);return this.user(this._connection._user.id)},Room.prototype.on=function(t,e,n){this._on("/.users",Room.VALID_EVENTS,t,e,n)},Room.prototype.off=function(t,e,n){this._off("/.users",Room.VALID_EVENTS,t,e,n)},Room.prototype.key=function(t){return new Key(this,t)},Room.prototype.channel=function(t){return new Channel(this,t)},Room.prototype._request=function(e,n,r){function o(t){return function(e,n,r){r&&(r.value=null),t(e,null,r)}}if(!this._connection._socket)return u(new a(c),r);var i=["JOIN","LEAVE"],l=t.pluck(this._connection._joinedRooms,"name");if(!t.contains(i,e)&&!t.contains(l,this.name)){var f='You must join the room "'+this.name+'" '+"before you can perform any operations on this key";return u(new s(f),r)}n.room=this.name;var p=n.options&&n.options.lastValue;"REMOVE"!==e||p||(r=o(r)),n.options&&delete n.options.lastValue,this._connection._request(e,n,r)},Room.prototype._on=function(e,n,r,o,s){function a(t){if(t.__wrapperFn)return t.__wrapperFn;var e=function(e,n){n&&(n.value=null),t(null,n)};return t.__wrapperFn=e,e}var u={};t.isFunction(o)?(s=o,o=null):o&&(o.listener&&(s=o.listener),u.local=o.local,u.bubble=o.bubble,o.lastValue&&(u.lastValue=!0)),t.defaults(u,f);var c;if(t.isString(r)?t.isString(e)?i.isFunction(s)?i.contained(n,r)?o&&!i.subset(t.keys(o),d)?c="on: options can only contain keys: "+d.join(",")+" but was passed keys: "+t.keys(o):i.subset(t.values(u),h)||(c="on: options.local, options.bubble, and options.lastValue must be booleans."):c='on: event passed: "'+r+'"'+" is not one of "+n.join(", "):c="on: listener must be a function":c="on: key name passed must be a string":c="on: command passed must be a string",c)throw new Error(c);r=r.toUpperCase(),"REMOVE"!==r||u.lastValue||(s=a(s)),this._connection._on(this.name,e,r,u,s)},Room.prototype._off=function(e,n,r,o,s){t.isUndefined(r)&&(r=null),t.isUndefined(o)&&(o=null),t.isUndefined(s)&&(s=null);var a=null;t.isFunction(o)?(s=o,o=null):t.isObject(o)&&(o.listener&&(s=o.listener),("local"in o||"bubble"in o)&&(a={},"local"in o&&(a.local=o.local),"bubble"in o&&(a.bubble=o.bubble)));var u,c=i.subset(t.values(a),h),l=i.contained(n,r);if(r&&!t.isString(r)?u="off: optional command must be a string":i.optionalCallback(s)?!r&&s?u="off: requires command if listener is passed":r&&!l?u='off: command passed: "'+r+'" is not one of '+n.join(", "):o&&!i.subset(t.keys(o),d)?u="off: options can only contain keys: "+d.join(", ")+" but was passed keys: "+t.keys(o):a&&!c&&(u="off: options.local and options.bubble must be booleans."):u="off: optional listener must be a function",u)throw new Error(u);r&&(r=r.toUpperCase()),s&&s.__wrapperFn&&(s=s.__wrapperFn),this._connection._off(this.name,e,r,o,s)},Room.prototype.equals=function(t){return t instanceof this.constructor?this.name===t.name:!1},Room}),define("platform/registry",["eventemitter2","lodash","common/obj"],function(t,e,n){function r(){this._rooms={}}function o(t,e,n){return t.length>n.length&&t.substring(0,n.length)==n}function i(t,e,n){if(t&&e){n.removeListener(t,e);var r=0===n.listeners(t).length;return r}return t?n.removeAllListeners(t):n.removeAllListeners(),!0}function s(t){return e.all(t._events,function(t){return!t||e.isArray(t)&&0===t.length})}var a=["JOIN","LEAVE"],u=["command","key","addedKey","value","room","userId","local","overwritten","expired","expire","cascaded","cascade"];return r.prototype.on=function(t,e){var n=t.room,r=t.key,o=t.opts,i=this._findEmitter(n,r,o),s=t.command;i.on(s,e)},r.prototype.off=function(t,e){var n=t.room,r=t.key,o=!1;return o=r?this._offKey(t,e):this._offRoom(n),this._deleteEmptyEmitter(n,r),o},r.prototype.emit=function(t){var r=this._findSubscribingEmitters(t);if(e.contains(a,t.command))return e.each(r,function(e){e.emit(t.command,t.value)}),void 0;var o=this._findChildEmitters(t);e.each(o,function(r){var o=e.pick(t,u);if(o.key=r.name,o.targetKey=t.key,o.currentKey=r.name,o.bubble=!1,"REMOVE"===o.command)return o.value=null,r.emit(o.command,o.value,o);var i=r.name.replace(o.targetKey,""),s=n.pick(o.value,i);return void 0===s?(o.command="REMOVE",o.value=null,r.emit(o.command,o.value,o)):(o.value=s,r.emit(o.command,o.value,o),void 0)}),e.each(r,function(n){var r=e.pick(t,u);r.targetKey=t.key,r.currentKey=n.name,r.bubble=r.currentKey!==t.key,n.emit(r.command,r.value,r)})},r.prototype._findEmitters=function(t,e){this._rooms[t]||(this._rooms[t]={});var n=this._rooms[t],r=n[e];return r?[r.bubble.local,r.bubble.remote,r.noBubble.local,r.noBubble.remote]:[]},r.prototype._findEmitter=function(n,r,o){this._rooms[n]||(this._rooms[n]={});var i=this._rooms[n];i[r]||(i[r]={name:r,bubble:{local:new t,remote:new t},noBubble:{local:new t,remote:new t}},e.each(this._findEmitters(n,r),function(t){t.name=r}));var s=i[r];return o.local&&o.bubble?s.bubble.local:o.bubble?s.bubble.remote:o.local?s.noBubble.local:s.noBubble.remote},r.prototype._findSubscribingEmitters=function(t){var e=t.room,n=t.key;this._rooms[e]||(this._rooms[e]={});var r=this._rooms[e],o=[];if(t.options.bubble){var i=this._findBubblingEmitters(t);o=o.concat(i)}var s=r[n];return s?(t.local?(o.unshift(s.noBubble.local),o.unshift(s.bubble.local)):(o.unshift(s.noBubble.remote),o.unshift(s.noBubble.local),o.unshift(s.bubble.remote),o.unshift(s.bubble.local)),o):o},r.prototype._findBubblingEmitters=function(t){var n=t.room,r=t.key,i=this._rooms[n],s=e.filter(i,e.partial(o,r));s=s.sort(function(t,e){return t.name.length<e.name.length});var a=[];return e.each(s,function(e){t.local?a.push(e.bubble.local):(a.push(e.bubble.remote),a.push(e.bubble.local))}),a},r.prototype._findChildEmitters=function(t){var n=t.room,r=this._rooms[n],o=t.addedKey?t.addedKey:t.key,i=e.filter(r,function(t,e){var n=e.substring(0,o.length);return n===o&&"/"===e[o.length]});i=i.sort(function(t,e){return t.length>e.length?1:e.length>t.length?-1:0});var s=[];return e.each(i,function(e){t.local?(s.unshift(e.noBubble.local),s.unshift(e.bubble.local)):(s.unshift(e.noBubble.remote),s.unshift(e.noBubble.local),s.unshift(e.bubble.remote),s.unshift(e.bubble.local))}),s},r.prototype._offRoom=function(t){var n=this._rooms[t];return e.each(n,function(t){e.each([t.bubble.local,t.bubble.remote,t.noBubble.local,t.noBubble.remote],e.partial(i,null,null))}),delete this._rooms[t],!0},r.prototype._offKey=function(t,n){var r=t.room,o=t.command,s=t.key,a=t.opts;if(a){var u=this._findEmitter(r,s,a);return i(o,n,u)}var c=this._findEmitters(r,s),l=e.map(c,e.partial(i,o,n));return e.all(l)},r.prototype._deleteEmptyEmitter=function(t,n){if(n){var r=this._findEmitters(t,n);if(r){var o=e.all(r,s);if(o){var i=this._rooms[t];delete i[n],0===e.size(this._rooms)&&delete this._rooms[t]}}}},r}),define("util/timeouts",["eventemitter2","lodash","global/window"],function(t,e,n){function r(n){this._emitter=new t,this._timeout=n,this._timer=null,this._timeouts=[],e.bindAll(this,"_handleExpiry")}return r.prototype.add=function(t){this._timeouts.push({item:t,when:+new Date+this._timeout}),1===this._timeouts.length&&this._start()},r.prototype.clear=function(t){var n=e.findIndex(this._timeouts,{item:t});if(-1!==n){var r=this._timeouts.splice(n,1)[0];this._timeouts.length<=0?this._stop():0===n&&this._timeouts[0].when!==r.when&&(this._stop(),this._start())}},r.prototype.on=function(t,e){this._emitter.on(t,e)},r.prototype.off=function(t,e){this._emitter.off(t,e)},r.prototype._start=function(){var t=+new Date,e=this._timeouts[0].when-t;this._timer=n.setTimeout(this._handleExpiry,e)},r.prototype._stop=function(){n.clearTimeout(this._timer),this._timer=null},r.prototype._handleExpiry=function(){for(var t=this._timeouts[0].when;this._timeouts.length>0&&this._timeouts[0].when===t;){var e=this._timeouts.shift();this._emitter.emit("expiry",e.item)}this._timeouts.length>0&&this._start()},r}),define("platform/room_collection",["lodash","common/errors","util/resolver"],function(t,e,n){function r(t){this._connection=t}var o=e.NotConnectedError,i="You must connect to Platform before you can perform operations on rooms";return r._Resolver=n,r.prototype.get=function(e){if(!this._connection._socket)return e(new o(i));if(e&&!t.isFunction(e))throw new Error("A callback if provided, must be a function.");var n=new r._Resolver(e,this);e=n.cb;var s=this;return this._connection._request("ROOMS",{},function(n,r){if(n)return e(n);var o=[];t.each(r,function(t){o.push(s._connection.room(t))}),e(null,o)}),n.promise},r}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/path",["lodash"],function(t){function e(t){return""===t[0]&&t.shift(),t}function n(t){return""===t[0]}var r={};return r.rInsert=function(t,r,o){var i=t.split("/"),s=n(i);i=e(i),o||(o={});var a=[];o.front&&a.push(r);for(var u=0;u<i.length;++u){a.push(i[u]);var c=u===i.length-1;if(c&&!o.rear)break;a.push(r)}return s&&a.unshift(""),a.join("/")},r.rStrip=function(e,n){var r=e.split("/"),o=t.filter(r,function(t){return t!=n});return o.join("/")},r}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);if(define("common/cascade",["common/obj","lodash","common/path"],function(t,e,n){var r={};return r.get=function(r,o){function i(t){return e.map(t,function(t){return n.rInsert(t,".value",{front:!0})})}var s,a=[],u=[];u.push(o);do{var c=u.shift();if(c){if(s=t.pick(r,c)){var l=s[".meta"];if(l){var f=l.cascade;e.isString(f)&&(f=[f]),f=i(f),a=e.union(a,f),u=e.union(u,f)}}}else s=void 0}while(s);return a},r}),"undefined"==typeof define&&module&&module.exports)var define=require("../lib/common_loader")(module);define("common/command_operator",["lodash","common/obj","common/path","common/cascade"],function(t,e,n,r){function o(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(arguments[n].split("/"));return e=t.transform(e,function(t,e){return t.push(e+"/.value")}),e.join("/")}function i(t,n,r,o){e.rZip(t,n,r,function(t,e){".value"!==e&&".meta"!==e&&(t[".version"]=o)})}var s={},a={};return a.SET=function(r,s){var a=[s.key,s.value];t.isPlainObject(s.value)&&(a=e.compose(s.key,s.value));var u=n.rInsert(s.key,".value",{front:!0});r=e.remove(r,u,{"throws":!1});for(var c=r[".version"]+1,l=0;l<a.length-1;l+=2){var f,p=t.isPlainObject(s.value),h=1==t.size(s.value),d=!!s.value[".meta"];p&&h&&d?(f=".value"+a[l],i(r,f,a[l+1],c)):(f=o(a[l]),i(r,f,a[l+1],c))}},a.SETNX=a.SET,a.ADD=function(t,e){var n=o(e.key,e.addedKey),r=t[".version"]+1;i(t,n,e.value,r)},a.REMOVE=function(i,s,a,u){var c=i[".version"]+1,l=o(s.key);l=l.substring(0,l.length-7);var f=r.get(i,l);f.unshift(l),t.each(f,function(r){if(e.remove(i,r,{"throws":!1},function(e){e!==i&&t.has(e,".version")&&!t.has(e,".value")&&(delete e[".version"],delete e[".meta"]),e[".version"]&&(e[".version"]=c)}),u&&a){var o=t.cloneDeep(a);o.key=n.rStrip(r,".value"),delete o.meta,delete o.commands,delete o.callbackId,delete o.version,o.options=o.options||{},u(o)}})},s.apply=function(e,n,r,o){return t.isArray(n)||(n=[n]),t.each(n,function(t){var n=a[t.cmd];if(!n)throw new Error("Unknown command: "+t.cmd);n(e,t,r,o)}),e},s}),define("protocol/storagev1",[],function(){function t(){}function e(){}return e.prototype.request=t,e.prototype.response=t,e.prototype.notify=t,e}),define("protocol/storagev2",["lodash","common/obj","common/command_operator","common/path"],function(t,e,n,r){function o(){this._trees={}}function i(n,o){var i=r.rInsert(o,".value",{front:!0}),s=e.pick(n,i);return t.isUndefined(s)?null:e.undecorate(s,["!.value",".meta",".version"],!0)}return o.prototype.request=function(e){t.has(this._trees,e.room)||(this._trees[e.room]={".version":0}),e.version=this._trees[e.room][".version"]},o.prototype.response=function(e,r){e.tree&&(this._trees[e.room]=e.tree);var o=this._trees[e.room];if(e.options=e.options||{},"SET"===e.command&&(e.overwritten=null!==i(o,e.key)),"REMOVE"===e.command&&(e.value=i(o,e.key)),"LEAVE"===e.command){var s="/.users/"+(e.userId||e.context.user.id);e.value=i(o,s)}if(e.commands&&e.commands.length>0){var a=e.commands[0].version-(o[".version"]+1),u=e.commands.slice(a);n.apply(o,u,e,r)}if("GET"===e.command)e.value=i(o,e.key);else if(e.version===o[".version"]+1){var c=t.omit(e,"command");c.cmd=e.command,("LEAVE"===e.command||"JOIN"===e.command)&&(c.key="/.users/"+(e.userId||e.context.user.id),c.cmd="LEAVE"===e.command?"REMOVE":"SET"),n.apply(o,c,e,this._emit)}delete e.version,delete e.tree,delete e.commands},o.prototype.notify=function(t,e){this.response(t,e),t.options=t.options||{}},o}),define("protocol/factory",["protocol/storagev1","protocol/storagev2"],function(t,e){function n(n){return 2===n?new e:new t}return n}),define("connection",["eventemitter2","eventutil","global/json","global/window","lodash","async","util/resolver","sharedConfig","util/guard","platform/socket","platform/room","platform/registry","util/validation","util/timeouts","platform/room_collection","common/command_operator","common/obj","common/errors","protocol/factory"],function(t,e,n,r,o,i,s,a,u,c,Room,l,f,p,h,d,m,v,y){function Connection(e,n){o.bindAll(this,"_onTimeout"),this._validateUrl(e),this._validateOpts(n),this._opts=n,this._socket=null,this._socketCleanup=function(){},this._user=null,this._joinedRooms=[],this.rooms=new h(this),this._registry=new l,this._emitter=new t,this._requestCallbackEmitter=new t,this._currentCallbackId=0,this._protocolStrategy=y(1),this._timeouts=new p(O),this._timeouts.on("expiry",this._onTimeout),u.all(this,I)}function g(){return a.authServerUrl||a.serverUrl.replace("://","://auth.")}var _="[\\d\\w][\\d\\w\\-]*",b="\\/(.+?)",w="(?:"+_+"\\.)*",k="(?:goinstant\\.(?:com|org|net))",E="(?::\\d{1,5})?",S="(?:$|\\/)",x="^((https?)://(?:"+w+k+"|"+"127\\.0\\.0\\.1"+"|"+"localhost(?:\\.localdomain)?"+")"+"("+E+")"+")",A=new RegExp(x+S),j=new RegExp(x+b+b+S),O=5e3,I=["_onMessage","_onError","_onConnect","_onDisconnect"];Connection.REQUEST_EXPIRY_TIME=O,Connection._Resolver=s,Connection.prototype._validateUrl=function(t){var e,n,r=!!t&&t.match(a.serverUrl)&&A.test(t);if(r&&(n=t.match(j),r=!!n),!r)throw e='Cannot connect to "'+t+'". The url must be a '+'registered application URL (e.g. "'+a.serverUrl+'/MYACCOUNT/MYAPP").',new v.ArgumentError(e);var o=n[1],i=n[2],s=n[3];if(this._account=n[4],this._application=n[5],a.httpsOnly&&(r="https"===i&&(!s||":443"===s)),!r)throw e='Cannot connect to "'+t+'". '+"The url must be an HTTPS url on the standard port (443).",new v.ArgumentError(e);/:\d+$/.test(o)||(o+=":443"),this._connectUrl=o},Connection.prototype._validateOpts=function(t){if(t){if(!o.isObject(t))throw new Error("opts, if provided, must be an object");delete t.sessionId;var e=o.difference(o.keys(t),["guestId"]);if(e.length>0)throw new Error("unknown option(s): "+e.join(", "));if(o.has(t,"guestId")&&!o.isString(t.guestId)&&t.guestId)throw new Error("opts.guestId must be a string or falsey value")}},Connection.prototype._createCallbackId=function(){return this._currentCallbackId++},Connection.prototype._request=function(t,e,n){n=n||function(){};var r=this._createCallbackId();this._requestCallbackEmitter.once(r,n),this._timeouts.add(r);var o=e.options||{},i={command:t,room:e.room,key:e.key,value:e.value,options:o,callbackId:r};this._protocolStrategy.request(i);try{this._socket.send(i)}catch(s){this._timeouts.clear(r),this._requestCallbackEmitter.emit(r,s)}},Connection.prototype._onResponse=function(t,e){var n=e.callbackId,r=null;return t&&(r=v.build(t,e)),"OFF"===e.command||"ON"===e.command?this._requestCallbackEmitter.emit(n,r):(this._protocolStrategy.response(e,o.bind(this._registry.emit,this._registry)),delete e.callbackId,delete e.meta,this._timeouts.clear(n),this._requestCallbackEmitter.emit(n,r,e.value,e),void 0)},Connection.prototype._onNotify=function(t){this._protocolStrategy.notify(t,o.bind(this._registry.emit,this._registry)),this._registry.emit(t)},Connection.prototype.connect=function(t,n){var r=this;(o.isFunction(t)||o.isUndefined(t))&&(n=t||function(){},t=null),n=u.one(n,r);var i=new Connection._Resolver(n,r);n=i.cb;var s=new c(r._connectUrl,r._account,r._application,t,this._opts);return s.connect(function(t,i){return t?n(t):(r._user=i,r._socket=s,r._socketCleanup=e.register(s,"message",o.bind(r._onMessage,r),s,"error",o.bind(r._onError,r),s,"disconnect",o.bind(r._onDisconnect,r),s,"connect",o.bind(r._onConnect,r)),r._onConnect(),n(null,r),void 0)}),i.promise},Connection.prototype.disconnect=function(t){var n=this,r=new Connection._Resolver(t,n);return t=r.cb,n._socket?(n._leaveAllRooms(function(r){function o(){t(r,n),n._onDisconnect()}function i(){t(new Error("Error during disconnect"),n)}n._socketCleanup(),e.register(n._socket,"!disconnect",o,n._socket,"!error",i),n._socket.close(),n._socket=null}),r.promise):t(null,n)},Connection.prototype._leaveAllRooms=function(t){var e=[],n=o.map(this._joinedRooms,function(t){return function(n){t.leave(function(r){r&&"User not in room"!==r.message&&e.push({name:t.name,err:r}),n()})}});i.parallel(n,function(){return e.length>0?t(new v.RoomSessionStateError("Failed to leave room(s).")):(t(),void 0)})},Connection.prototype.room=function(t){return new Room(this,t)},Connection.prototype._joined=function(t){var e=this._isJoined(t);e||this._joinedRooms.push(t)},Connection.prototype._isJoined=function(t){return o.any(this._joinedRooms,function(e){return t.name===e.name})},Connection.prototype._left=function(t){this._joinedRooms=o.without(this._joinedRooms,t)};var C=["connect","disconnect","error"];return Connection.prototype.on=function(t,e){if(!f.contained(C,t))throw new Error("Invalid event provided:"+t);this._emitter.on(t,e)},Connection.prototype.off=function(t,e){if(!f.contained(C,t))throw new Error("Invalid event provided:"+t);this._emitter.off(t,e)},Connection.prototype._on=function(t,e,n,r,o){this._registry.on({room:t,key:e,command:n,opts:r},o)},Connection.prototype._off=function(t,e,n,r,o){this._registry.off({room:t,key:e,command:n,opts:r},o)},Connection.prototype._rejoinRooms=function(t){var e=this;i.each(this._joinedRooms,function(t,e){t.join(e)},function(n){return n?e.disconnect(o.bind(t,null,n)):t()})},Connection.prototype._onConnect=function(){this.guestId=this._socket.guestId,this._protocolStrategy=y(this._socket.storageVersion);var t=this;this._rejoinRooms(function(e){return e?t._emitter.emit("error",e):(t._emitter.emit("connect"),void 0)})},Connection.prototype._onDisconnect=function(){this._emitter.emit("disconnect")},Connection.prototype._onError=function(t,e){var n=v.build(t,0+e);if(0===this._emitter.listeners("error").length)throw n;this._emitter.emit("error",n)},Connection.prototype._onMessage=function(t){var e=n.parse(t),r=e.shift();switch(r){case"RESPONSE":this._onResponse.apply(this,e);break;case"NOTIFY":this._onNotify.apply(this,e);break;case"ERROR":this._onError(e[1],e[2]);break;case"USER":break;default:this._onError('Unknown message type "'+r+'": '+t)}},Connection.prototype._onTimeout=function(t){var e=new Error("Request timed out");this._requestCallbackEmitter.emit(t,e)},Connection.prototype.loginUrl=function(t){t=t||r.location.href;var e=["account="+encodeURIComponent(this._account),"app="+encodeURIComponent(this._application),"returnTo="+encodeURIComponent(t)];return g()+"/begin?"+e.join("&")},Connection.prototype.logoutUrl=function(t){t=t||r.location.href;var e=["account="+encodeURIComponent(this._account),"app="+encodeURIComponent(this._application),"returnTo="+encodeURIComponent(t)];return g()+"/logout?"+e.join("&")},Connection}),define("connect",["lodash","async","util/resolver","connection","util/validation","common/errors"],function(t,e,n,Connection,r,o){var i={};i._Connection=Connection,i._Resolver=n;var s=["room","rooms","user","guestId","visible"];return i.start=function(n,a,u){function c(e){var r=a.user?a.user:null,o=t.pick(a,["guestId"]);try{f=new i._Connection(n,o),f.connect(r,e)}catch(s){e(s)}}function l(t,e){try{var n=f.room(t);if(m.isOpt){var r={visible:a.visible};return n.join(null,r,e)}n.join(e)}catch(o){e(o)}}var f;if(!t.isString(n))throw o.build("url must be a valid string",303);if(!r.optionalCallback(u))throw o.build("cb, if provided, must be valid",303);if(!u&&t.isFunction(a)&&(u=a,a={}),a=a||{},delete a.sessionId,!t.isFunction(a)&&!t.isPlainObject(a))throw o.build("opts if provided must be an object",303);var p={isOpt:t.has(a,"user"),isString:t.isString(a.user),isPlain:t.isPlainObject(a.user)};if(p.isOpt&&!p.isString&&!p.isPlain)throw o.build("opts.user if provided must be a jwt string or object",303);if(t.has(a,"room")&&t.has(a,"rooms"))throw o.build("opts can specify room or rooms, not both",303);var h={isOpt:t.has(a,"room"),isString:t.isString(a.room),isArray:t.isArray(a.room),allStrings:t.isArray(a.room)&&t.all(a.room,t.isString)};if(!(!h.isOpt||h.isString||h.isArray&&h.allStrings))throw o.build("room must be a string or an array of strings",303);
var d={isOpt:t.has(a,"rooms"),isString:t.isString(a.rooms),isArray:t.isArray(a.rooms),allStrings:t.isArray(a.rooms)&&t.all(a.rooms,t.isString)};if(!(!d.isOpt||d.isString||d.isArray&&d.allStrings))throw o.build("rooms must be a string or an array of strings",303);var m={isOpt:t.has(a,"visible"),isBoolean:t.isBoolean(a.visible)};if(m.isOpt&&!m.isBoolean)throw o.build("visible must be a boolean",303);var v=t.keys(a),y=t.difference(v,s);if(y.length)throw o.build("invalid option(s) provided: "+y.join(", "),303);var g=new i._Resolver(u,this,["connection","rooms..."]);u=g.cb;var _;if(_=a.room?a.room:a.rooms?a.rooms:["lobby"],t.isString(_)&&(_=[_]),!_.length)throw o.build("room(s) can not be an empty array",303);return e.series({connection:c,rooms:e.apply(e.map,_,l)},function(t,e){if(t)return f?f.disconnect(function(){return u(t)}):u(t);var n=e.rooms;n.unshift(f),n.unshift(null),u.apply(u,n)}),g.promise},i}),define("prod/main",["hide_lodash","iefix","global/window","connection","connect","common/errors","platform/room","platform/key","platform/channel","platform/query","sharedConfig"],function(t,e,n,Connection,r,o,Room,Key,Channel,Query,i){n.goinstant=n.goinstant||{},n.goinstant.Connection=Connection,n.goinstant.connect=r.start,n.goinstant.errors=o,n.goinstant.Room=Room,n.goinstant.Key=Key,n.goinstant.Channel=Channel,n.goinstant.Query=Query,n.goinstant.sharedConfig=i}),require("prod/main")}();